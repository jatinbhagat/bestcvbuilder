import"./output-DEU4ITj2-v2.js";import{S as L,s as T,D as h}from"./supabase-TKoVn4-v-v2.js";async function B(e,t=null){try{if(console.log("Starting file upload:",e.name),!P(e))throw new Error("Invalid file type or size");const s=await L.uploadFile(e,t);return console.log("File uploaded successfully:",s),s}catch(s){throw console.error("File upload failed:",s),s.message&&s.message.includes("violates row-level security")?new Error("Storage access denied. Please contact support."):s}}function P(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return console.error("Invalid file type:",e.type),!1;const s=10*1024*1024;return e.size>s?(console.error("File too large:",e.size),!1):!0}const x=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1",m=x?"https://bestcvbuilder-api.onrender.com/api":"/api",u=`${m}/cv-parser`,v="BUILD-2025-08-05-08:30:00-UI-FIXED";console.log("üîó API Configuration v1.1.0:",{API_BASE_URL:m,CV_PARSER_ENDPOINT:u});console.log("üö® CRITICAL: Verify this shows correct URL - should NOT be bestcvbuilder-gamma!");async function C(){console.log("üîç Testing API connectivity (non-blocking)...");let e=!1,t=!1;try{const o=new AbortController,n=setTimeout(()=>o.abort(),5e3),a=await fetch("https://bestcvbuilder-api.onrender.com/health",{method:"GET",mode:"cors",cache:"no-cache",signal:o.signal});clearTimeout(n),e=a.status===200,console.log(`${e?"‚úÖ":"‚ùå"} Health check: ${a.status}`)}catch(o){console.log(`‚ùå Health check failed: ${o.message}`)}try{const o=new AbortController,n=setTimeout(()=>o.abort(),3e3),a=await fetch(u,{method:"OPTIONS",mode:"cors",headers:{"Content-Type":"application/json"},signal:o.signal});clearTimeout(n),t=a.status===200,console.log(`${t?"‚úÖ":"‚ùå"} CORS preflight: ${a.status}`)}catch(o){console.log(`‚ùå CORS test failed: ${o.message}`)}const s=e||t;return console.log(`üìä Connectivity summary: Health=${e}, CORS=${t}, Overall=${s}`),s}async function D(e,t=null){try{console.log("Starting ATS analysis for file:",e),C().catch(i=>{console.warn("‚ö†Ô∏è Background connectivity test failed:",i.message)});const s={file_url:e,analysis_type:"ats_score",include_recommendations:!0};t&&(s.user_id=t,console.log("Including user_id for database saving:",t)),console.log("üöÄ Making request to:",u),console.log("üì§ Request body:",s);let o;const n=[{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)},{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)},{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}];let a;for(let i=0;i<n.length;i++)try{console.log(`üîÑ Attempt ${i+1}/3 with configuration:`,n[i]),o=await fetch(u,n[i]),console.log(`‚úÖ Attempt ${i+1} succeeded:`,o.status);break}catch(d){if(console.log(`‚ùå Attempt ${i+1} failed:`,d.message),a=d,i===n.length-1)throw a}if(console.log("üì® Response received:",o.status,o.statusText),!o.ok){let i=`API request failed: ${o.status}`;try{i=`API request failed: ${(await o.json()).error||o.statusText}`}catch{console.warn("Could not parse error response as JSON")}throw new Error(i)}const c=await o.json();return console.log("ATS analysis completed:",c),_(c,e)}catch(s){if(console.error("ATS analysis failed:",s),s.name==="TypeError"&&s.message.includes("Failed to fetch")){console.log("üîÑ Primary API failed, attempting diagnostics...");try{const n=await fetch("https://httpbin.org/ip");console.log("‚úÖ Internet connectivity confirmed, issue is with API endpoint")}catch{console.log("‚ùå No internet connectivity detected")}const o=new Error(`‚ùå Cannot connect to the resume analysis service.

üîç Technical Details:
‚Ä¢ Endpoint: ${u}
‚Ä¢ Error: ${s.message}

üõ†Ô∏è Possible Solutions:
‚Ä¢ Check your internet connection
‚Ä¢ Try refreshing the page
‚Ä¢ Disable VPN or proxy if using one
‚Ä¢ Try using a different browser
‚Ä¢ Contact support if the issue persists

üåê If you're on a corporate network, this service may be blocked by your firewall.`);throw o.name="NetworkError",o}throw s}}function _(e,t){return{score:e.ats_score||0,scoreCategory:k(e.ats_score),strengths:e.strengths||[],improvements:e.improvements||[],detailedAnalysis:e.detailed_analysis||"",keywords:e.keywords||[],missingKeywords:e.missing_keywords||[],formattingIssues:e.formatting_issues||[],suggestions:e.suggestions||[],originalFileUrl:t,file_url:e.file_url||t,content:e.content||"",timestamp:new Date().toISOString()}}function k(e){return e>=90?"excellent":e>=80?"good":e>=70?"fair":e>=60?"poor":"very_poor"}const F=async(e,t=null)=>D(e,t),I=document.getElementById("uploadForm"),g=document.getElementById("fileInput"),l=document.getElementById("analyzeBtn");document.getElementById("loadingState");const r=document.getElementById("uploadArea");function O(){console.log("BestCVBuilder initialized"),z(),X(),$(),W()}function $(){console.log("üèóÔ∏è BUILD INFO:",{BUILD_ID:v,API_BASE_URL:m,CV_PARSER_ENDPOINT:u});const e=document.createElement("div");e.id="build-info",e.style.cssText=`
        position: fixed; 
        bottom: 10px; 
        right: 10px; 
        background: #1f2937; 
        color: #10b981; 
        padding: 8px 12px; 
        border-radius: 6px; 
        font-family: monospace; 
        font-size: 11px; 
        z-index: 9999;
        border: 1px solid #10b981;
    `,e.textContent=`${v} | API: ${m}`,document.body.appendChild(e);const t=document.querySelector("h1");t&&(t.textContent=`BestCVBuilder [${v.slice(-10)}]`)}function z(){g&&g.addEventListener("change",N),I&&I.addEventListener("submit",R),document.addEventListener("resumeUpload",U),r&&(r.addEventListener("dragover",j),r.addEventListener("drop",V),r.addEventListener("dragenter",Y),r.addEventListener("dragleave",J))}function N(e){const t=e.target.files[0];if(t&&b(t)){const s=document.getElementById("fileName"),o=document.getElementById("fileInfo");s&&(s.textContent=t.name),o&&o.classList.remove("hidden"),l&&(l.disabled=!1)}}async function R(e){e.preventDefault();const t=g?g.files[0]:null;if(!t){p("Please select a resume file");return}await A(t)}async function U(e){const{file:t}=e.detail;t&&b(t)&&await A(t)}function b(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return p("Please upload a PDF, DOCX, or DOC file"),!1;const s=10*1024*1024;return e.size>s?(p("File size must be less than 10MB"),!1):(M(e),!0)}function M(e){const t=`${e.name} (${q(e.size)})`;console.log("File selected:",t)}function q(e){if(e===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+s[o]}async function A(e){try{console.log("üöÄ Starting resume processing for:",e.name),await h.logActivity(null,"file_upload_started",{filename:e.name,filesize:e.size,filetype:e.type}),E(!0),console.log("üì§ Step 1: Uploading file to storage..."),G();const t=await B(e);console.log("‚úÖ File uploaded successfully:",t),await h.logActivity(null,"file_upload_completed",{filename:e.name,file_url:t}),console.log("üîç Step 2: Starting ATS analysis..."),K();let s=null;try{const{data:{user:n}}=await T.auth.getUser();n?(s=n.id,console.log("User ID found for database saving:",s)):console.log("No user logged in - proceeding without database save")}catch(n){console.log("Error getting user:",n)}const o=await F(t,s);if(console.log("‚úÖ Analysis completed:",o),!o||!o.score)throw new Error("Invalid analysis result received");await h.logActivity(s,"ats_analysis_completed",{score:o.score,scoreCategory:o.scoreCategory,filename:e.name,analysis_id:o.id||`analysis_${Date.now()}`}),console.log("üíæ Step 3: Storing results..."),sessionStorage.setItem("atsAnalysis",JSON.stringify(o)),console.log("üîÄ Step 4: Redirecting to results..."),window.location.href="./result.html"}catch(t){console.error("Error processing resume:",t);let s="Failed to analyze resume. Please try again.";t.message.includes("upload")?s="File upload failed. Please check your connection and try again.":(t.message.includes("analysis")||t.message.includes("analyze"))&&(s="Resume analysis failed. Please try again in a moment."),p(s)}finally{E(!1)}}function j(e){e.preventDefault(),r.classList.add("dragover")}function Y(e){e.preventDefault(),r.classList.add("dragover")}function J(e){e.preventDefault(),r.classList.remove("dragover")}function V(e){e.preventDefault(),r.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const s=t[0];if(g){const o=new DataTransfer;o.items.add(s),g.files=o.files}if(b(s)){const o=document.getElementById("fileName"),n=document.getElementById("fileInfo");o&&(o.textContent=s.name),n&&n.classList.remove("hidden"),l&&(l.disabled=!1)}}}class H{constructor(){this.currentStep=0,this.steps=["step-1","step-2","step-3"],this.isActive=!1}show(){const t=document.getElementById("atsLoadingScreen");t?(t.classList.remove("hidden"),this.isActive=!0,this.resetProgress()):console.warn("ATS Loading Screen element not found - falling back to basic loading")}hide(){const t=document.getElementById("atsLoadingScreen");t&&(t.classList.add("hidden"),this.isActive=!1)}resetProgress(){this.currentStep=0,this.updateProgress(0),this.updateTimeRemaining("few seconds"),this.steps.forEach((t,s)=>{const o=document.getElementById(t);if(o){const n=o.querySelector(".loading-dot");s===0?(o.style.opacity="1",n&&(n.classList.add("bg-blue-500"),n.classList.remove("bg-gray-500"),n.classList.add("animate-pulse"))):(o.style.opacity="0.4",n&&(n.classList.add("bg-gray-500"),n.classList.remove("bg-blue-500"),n.classList.remove("animate-pulse"))),o.classList.remove("step-complete")}})}completeStep(t){const s=this.steps.indexOf(t);if(s===-1)return;const o=document.getElementById(t);if(o){const c=o.querySelector(".loading-dot");o.classList.add("step-complete"),o.style.opacity="1",c&&(c.classList.remove("animate-pulse","bg-blue-500","bg-gray-500"),c.classList.add("bg-green-500"));const i=s+1;if(i<this.steps.length){const d=this.steps[i],f=document.getElementById(d);if(f){const y=f.querySelector(".loading-dot");f.style.opacity="1",y&&(y.classList.add("bg-blue-500","animate-pulse"),y.classList.remove("bg-gray-500"))}}}const n=Math.round((s+1)/this.steps.length*100);this.updateProgress(n);const a=s===this.steps.length-1?"ready!":"few seconds";this.updateTimeRemaining(a)}updateProgress(t){const s=document.getElementById("progressBar"),o=document.getElementById("progressText");s&&(s.style.width=`${t}%`),o&&(o.textContent=`${t}%`)}updateTimeRemaining(t){const s=document.getElementById("timeRemaining");s&&(s.textContent=t)}async startAnalysisSequence(){this.isActive&&(await this.delay(1500),this.completeStep("step-1"),this.isActive&&(await this.delay(2e3),this.completeStep("step-2"),this.isActive&&(await this.delay(1e3),this.completeStep("step-3"),this.isActive&&(this.updateProgress(100),this.updateTimeRemaining("ready!")))))}delay(t){return new Promise(s=>setTimeout(s,t))}}const S=new H;function E(e){const t=document.getElementById("buttonText"),s=document.getElementById("loadingText");if(e){try{S.show(),S.startAnalysisSequence()}catch(o){console.warn("ATS loading screen error, falling back to simple loading:",o)}t&&(t.style.display="none"),s&&(s.style.display="flex"),l&&(l.disabled=!0)}else{try{S.hide()}catch(o){console.warn("Error hiding ATS loading screen:",o)}t&&(t.style.display="inline"),s&&(s.style.display="none"),l&&(l.disabled=!1)}}function G(){console.log("üì§ Upload progress started")}function K(){console.log("üîç Analysis in progress")}function p(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}async function X(){try{const{data:{session:e}}=await T.auth.getSession();e&&console.log("User session found:",e.user.email)}catch(e){console.error("Error checking session:",e)}}function W(){const e=document.getElementById("testingControls"),t=document.getElementById("enableBypassBtn"),s=document.getElementById("disableBypassBtn"),o=window.location.hostname,n=o==="localhost"||o==="127.0.0.1"||o.includes("localhost")||o.includes("preview")||o.includes("render.com")||o.includes("onrender.com")||o.includes("vercel.app");if(console.log("üîç Testing controls check:"),console.log("  - Current hostname:",o),console.log("  - Show testing controls:",n),n){e&&e.classList.remove("hidden");const a=sessionStorage.getItem("BYPASS_PAYMENT")==="true";w(a),t&&t.addEventListener("click",()=>{sessionStorage.setItem("BYPASS_PAYMENT","true"),w(!0),showSuccess("Payment bypass enabled for testing!")}),s&&s.addEventListener("click",()=>{sessionStorage.removeItem("BYPASS_PAYMENT"),w(!1),showSuccess("Payment bypass disabled")})}}function w(e){const t=document.getElementById("enableBypassBtn"),s=document.getElementById("disableBypassBtn");e?(t==null||t.classList.add("hidden"),s==null||s.classList.remove("hidden")):(t==null||t.classList.remove("hidden"),s==null||s.classList.add("hidden"))}document.addEventListener("DOMContentLoaded",O);
