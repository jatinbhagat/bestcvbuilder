import{S as h,s as f}from"./supabase-6siEAxIw-v2.js";/* empty css                  */async function v(e,t=null){try{if(console.log("Starting file upload:",e.name),!w(e))throw new Error("Invalid file type or size");const o=await h.uploadFile(e,t);return console.log("File uploaded successfully:",o),o}catch(o){throw console.error("File upload failed:",o),o.message&&o.message.includes("violates row-level security")?new Error("Storage access denied. Please contact support."):o}}function w(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return console.error("Invalid file type:",e.type),!1;const o=10*1024*1024;return e.size>o?(console.error("File too large:",e.size),!1):!0}const I=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1",r=I?"https://bestcvbuilder-api.onrender.com/api":"/api",c=`${r}/cv-parser`,l="BUILD-2025-08-04-08:00:00-RENDER-API";console.log("🔗 API Configuration v1.1.0:",{API_BASE_URL:r,CV_PARSER_ENDPOINT:c});console.log("🚨 CRITICAL: Verify this shows correct URL - should NOT be bestcvbuilder-gamma!");async function E(e,t=null){try{console.log("Starting ATS analysis for file:",e);const o={file_url:e,analysis_type:"ats_score",include_recommendations:!0};t&&(o.user_id=t,console.log("Including user_id for database saving:",t));const s=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!s.ok)throw new Error(`API request failed: ${s.status}`);const n=await s.json();return console.log("ATS analysis completed:",n),B(n)}catch(o){throw console.error("ATS analysis failed:",o),o}}function B(e){return{score:e.ats_score||0,scoreCategory:S(e.ats_score),strengths:e.strengths||[],improvements:e.improvements||[],detailedAnalysis:e.detailed_analysis||"",keywords:e.keywords||[],missingKeywords:e.missing_keywords||[],formattingIssues:e.formatting_issues||[],suggestions:e.suggestions||[],timestamp:new Date().toISOString()}}function S(e){return e>=90?"excellent":e>=80?"good":e>=70?"fair":e>=60?"poor":"very_poor"}const L=async(e,t=null)=>E(e,t),d=document.getElementById("uploadForm"),u=document.getElementById("resumeFile"),m=document.getElementById("uploadBtn"),p=document.getElementById("loadingState"),a=document.querySelector(".border-dashed");function b(){console.log("BestCVBuilder initialized"),F(),$(),P()}function P(){console.log("🏗️ BUILD INFO:",{BUILD_ID:l,API_BASE_URL:r,CV_PARSER_ENDPOINT:c});const e=document.createElement("div");e.id="build-info",e.style.cssText=`
        position: fixed; 
        bottom: 10px; 
        right: 10px; 
        background: #1f2937; 
        color: #10b981; 
        padding: 8px 12px; 
        border-radius: 6px; 
        font-family: monospace; 
        font-size: 11px; 
        z-index: 9999;
        border: 1px solid #10b981;
    `,e.textContent=`${l} | API: ${r}`,document.body.appendChild(e);const t=document.querySelector("h1");t&&(t.textContent=`BestCVBuilder [${l.slice(-10)}]`)}function F(){u.addEventListener("change",D),d.addEventListener("submit",x),a&&(a.addEventListener("dragover",T),a.addEventListener("drop",O),a.addEventListener("dragenter",_),a.addEventListener("dragleave",U))}function D(e){const t=e.target.files[0];t&&y(t)}async function x(e){e.preventDefault();const t=u.files[0];if(!t){i("Please select a resume file");return}await A(t)}function y(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return i("Please upload a PDF, DOCX, or DOC file"),!1;const o=10*1024*1024;return e.size>o?(i("File size must be less than 10MB"),!1):(C(e),!0)}function C(e){const t=`${e.name} (${z(e.size)})`;console.log("File selected:",t)}function z(e){if(e===0)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,s)).toFixed(2))+" "+o[s]}async function A(e){try{console.log("🚀 Starting resume processing for:",e.name),g(!0),console.log("📤 Step 1: Uploading file to storage..."),M();const t=await v(e);console.log("✅ File uploaded successfully:",t),N(),await new Promise(n=>setTimeout(n,800)),console.log("🔍 Step 2: Starting ATS analysis..."),R();let o=null;try{const{data:{user:n}}=await f.auth.getUser();n?(o=n.id,console.log("User ID found for database saving:",o)):console.log("No user logged in - proceeding without database save")}catch(n){console.log("Error getting user:",n)}const s=await L(t,o);if(console.log("✅ Analysis completed:",s),!s||!s.score)throw new Error("Invalid analysis result received");console.log("💾 Step 3: Storing results..."),sessionStorage.setItem("atsAnalysis",JSON.stringify(s)),console.log("🔀 Step 4: Redirecting to results..."),window.location.href="./result.html"}catch(t){console.error("Error processing resume:",t);let o="Failed to analyze resume. Please try again.";t.message.includes("upload")?o="File upload failed. Please check your connection and try again.":(t.message.includes("analysis")||t.message.includes("analyze"))&&(o="Resume analysis failed. Please try again in a moment."),i(o)}finally{g(!1)}}function T(e){e.preventDefault(),a.classList.add("border-primary-500","bg-primary-50")}function _(e){e.preventDefault(),a.classList.add("border-primary-500","bg-primary-50")}function U(e){e.preventDefault(),a.classList.remove("border-primary-500","bg-primary-50")}function O(e){e.preventDefault(),a.classList.remove("border-primary-500","bg-primary-50");const t=e.dataTransfer.files;if(t.length>0){const o=t[0];u.files=t,y(o)}}function g(e){e?(d.classList.add("hidden"),p.classList.remove("hidden"),m.disabled=!0,k()):(d.classList.remove("hidden"),p.classList.add("hidden"),m.disabled=!1)}function k(){document.getElementById("uploadProgress").classList.remove("hidden"),document.getElementById("uploadComplete").classList.add("hidden"),document.getElementById("analysisProgress").classList.add("hidden"),document.getElementById("uploadBar").style.width="0%"}function M(){document.getElementById("uploadProgress").classList.remove("hidden"),document.getElementById("uploadComplete").classList.add("hidden"),document.getElementById("analysisProgress").classList.add("hidden");let e=0;const t=document.getElementById("uploadBar"),o=setInterval(()=>{e+=Math.random()*15,e>=95&&(e=95,clearInterval(o)),t.style.width=e+"%"},100)}function N(){document.getElementById("uploadBar").style.width="100%",setTimeout(()=>{document.getElementById("uploadProgress").classList.add("hidden"),document.getElementById("uploadComplete").classList.remove("hidden")},300)}function R(){document.getElementById("uploadComplete").classList.add("hidden"),document.getElementById("analysisProgress").classList.remove("hidden")}function i(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}async function $(){try{const{data:{session:e}}=await f.auth.getSession();e&&console.log("User session found:",e.user.email)}catch(e){console.error("Error checking session:",e)}}document.addEventListener("DOMContentLoaded",b);
