import{S as w,s as y,D as d}from"./supabase-DQ_B3N6C-v2.js";import{C as E,A as m,B as c,a as I}from"./atsAnalysis-B5aCNDb1-v2.js";async function S(e,t=null){try{if(console.log("Starting file upload:",e.name),!B(e))throw new Error("Invalid file type or size");const o=await w.uploadFile(e,t);return console.log("File uploaded successfully:",o),o}catch(o){throw console.error("File upload failed:",o),o.message&&o.message.includes("violates row-level security")?new Error("Storage access denied. Please contact support."):o}}function B(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return console.error("Invalid file type:",e.type),!1;const o=10*1024*1024;return e.size>o?(console.error("File too large:",e.size),!1):!0}const g=document.getElementById("uploadForm"),i=document.getElementById("fileInput"),l=document.getElementById("analyzeBtn");document.getElementById("loadingState");const a=document.getElementById("uploadArea");function b(){console.log("BestCVBuilder initialized"),L(),k(),x(),R()}function x(){console.log("ðŸ—ï¸ BUILD INFO:",{BUILD_ID:c,API_BASE_URL:m,CV_PARSER_ENDPOINT:E});const e=document.createElement("div");e.id="build-info",e.style.cssText=`
        position: fixed; 
        bottom: 10px; 
        right: 10px; 
        background: #1f2937; 
        color: #10b981; 
        padding: 8px 12px; 
        border-radius: 6px; 
        font-family: monospace; 
        font-size: 11px; 
        z-index: 9999;
        border: 1px solid #10b981;
    `,e.textContent=`${c} | API: ${m}`,document.body.appendChild(e);const t=document.querySelector("h1");t&&(t.textContent=`BestCVBuilder [${c.slice(-10)}]`)}function L(){i&&i.addEventListener("change",D),g&&g.addEventListener("submit",F),document.addEventListener("resumeUpload",C),a&&(a.addEventListener("dragover",z),a.addEventListener("drop",U),a.addEventListener("dragenter",T),a.addEventListener("dragleave",_))}function D(e){const t=e.target.files[0];if(t&&f(t)){const o=document.getElementById("fileName"),n=document.getElementById("fileInfo");o&&(o.textContent=t.name),n&&n.classList.remove("hidden"),l&&(l.disabled=!1)}}async function F(e){e.preventDefault();const t=i?i.files[0]:null;if(!t){r("Please select a resume file");return}await h(t)}async function C(e){const{file:t}=e.detail;t&&f(t)&&await h(t)}function f(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return r("Please upload a PDF, DOCX, or DOC file"),!1;const o=10*1024*1024;return e.size>o?(r("File size must be less than 10MB"),!1):(P(e),!0)}function P(e){const t=`${e.name} (${A(e.size)})`;console.log("File selected:",t)}function A(e){if(e===0)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+o[n]}async function h(e){try{console.log("ðŸš€ Starting resume processing for:",e.name),await d.logActivity(null,"file_upload_started",{filename:e.name,filesize:e.size,filetype:e.type}),p(!0),console.log("ðŸ“¤ Step 1: Uploading file to storage..."),N();const t=await S(e);console.log("âœ… File uploaded successfully:",t),await d.logActivity(null,"file_upload_completed",{filename:e.name,file_url:t}),console.log("ðŸ” Step 2: Starting ATS analysis..."),M();let o=null;try{const{data:{user:s}}=await y.auth.getUser();s?(o=s.id,console.log("User ID found for database saving:",o)):console.log("No user logged in - proceeding without database save")}catch(s){console.log("Error getting user:",s)}const n=await I(t,o);if(console.log("âœ… Analysis completed:",n),!n||!n.score)throw new Error("Invalid analysis result received");await d.logActivity(o,"ats_analysis_completed",{score:n.score,scoreCategory:n.scoreCategory,filename:e.name,analysis_id:n.id||`analysis_${Date.now()}`}),console.log("ðŸ’¾ Step 3: Storing results..."),sessionStorage.setItem("atsAnalysis",JSON.stringify(n)),console.log("ðŸ”€ Step 4: Redirecting to results..."),window.location.href="./result.html"}catch(t){console.error("Error processing resume:",t);let o="Failed to analyze resume. Please try again.";t.message.includes("upload")?o="File upload failed. Please check your connection and try again.":(t.message.includes("analysis")||t.message.includes("analyze"))&&(o="Resume analysis failed. Please try again in a moment."),r(o)}finally{p(!1)}}function z(e){e.preventDefault(),a.classList.add("dragover")}function T(e){e.preventDefault(),a.classList.add("dragover")}function _(e){e.preventDefault(),a.classList.remove("dragover")}function U(e){e.preventDefault(),a.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const o=t[0];if(i){const n=new DataTransfer;n.items.add(o),i.files=n.files}if(f(o)){const n=document.getElementById("fileName"),s=document.getElementById("fileInfo");n&&(n.textContent=o.name),s&&s.classList.remove("hidden"),l&&(l.disabled=!1)}}}function p(e){const t=document.getElementById("buttonText"),o=document.getElementById("loadingText");e?(t&&(t.style.display="none"),o&&(o.style.display="flex"),l&&(l.disabled=!0)):(t&&(t.style.display="inline"),o&&(o.style.display="none"),l&&(l.disabled=!1))}function N(){console.log("ðŸ“¤ Upload progress started")}function M(){console.log("ðŸ” Analysis in progress")}function r(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}async function k(){try{const{data:{session:e}}=await y.auth.getSession();e&&console.log("User session found:",e.user.email)}catch(e){console.error("Error checking session:",e)}}function R(){const e=document.getElementById("testingControls"),t=document.getElementById("enableBypassBtn"),o=document.getElementById("disableBypassBtn"),n=window.location.hostname,s=n==="localhost"||n==="127.0.0.1"||n.includes("localhost")||n.includes("preview")||n.includes("render.com")||n.includes("onrender.com")||n.includes("vercel.app");if(console.log("ðŸ” Testing controls check:"),console.log("  - Current hostname:",n),console.log("  - Show testing controls:",s),s){e&&e.classList.remove("hidden");const v=sessionStorage.getItem("BYPASS_PAYMENT")==="true";u(v),t&&t.addEventListener("click",()=>{sessionStorage.setItem("BYPASS_PAYMENT","true"),u(!0),showSuccess("Payment bypass enabled for testing!")}),o&&o.addEventListener("click",()=>{sessionStorage.removeItem("BYPASS_PAYMENT"),u(!1),showSuccess("Payment bypass disabled")})}}function u(e){const t=document.getElementById("enableBypassBtn"),o=document.getElementById("disableBypassBtn");e?(t==null||t.classList.add("hidden"),o==null||o.classList.remove("hidden")):(t==null||t.classList.remove("hidden"),o==null||o.classList.add("hidden"))}document.addEventListener("DOMContentLoaded",b);
