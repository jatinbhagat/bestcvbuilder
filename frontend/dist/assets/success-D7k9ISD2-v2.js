import{D as v,s as S}from"./supabase-DQ_B3N6C-v2.js";const y=document.getElementById("originalScore"),b=document.getElementById("newScore"),u=document.getElementById("improvement"),w=document.getElementById("downloadBtn"),x=document.getElementById("downloadTextBtn"),c=document.getElementById("submitFeedbackBtn"),h=document.getElementById("newAnalysisBtn"),_=document.getElementById("homeBtn"),k=document.getElementById("optimizeForJobBtn"),I=document.getElementById("feedbackComment"),E=document.querySelectorAll(".rating-btn");let o=null,p=null;function B(){console.log("Success page initialized"),v.logActivity(null,"success_page_visited",{source:"upgrade_flow",timestamp:new Date().toISOString()}),C(),T()}function C(){try{const e=sessionStorage.getItem("cvRewriteResult");if(!e){console.warn("No CV rewrite data found"),a("No CV rewrite data available.");return}o=JSON.parse(e),console.log("Loaded CV rewrite data:",o),D()}catch(e){console.error("Error loading CV rewrite data:",e),a("Failed to load CV rewrite results.")}}function D(){if(!o)return;const e=o.original_score||0,t=o.new_score||0,n=o.score_improvement||0;y&&(y.textContent=e),b&&(b.textContent=t),u&&(u.textContent=`+${n}`,u.className=n>0?"text-lg font-semibold text-success-600":"text-lg font-semibold text-gray-600"),O()}function T(){w&&w.addEventListener("click",L),x&&x.addEventListener("click",F),c&&c.addEventListener("click",N),h&&h.addEventListener("click",R),_&&_.addEventListener("click",$),k&&k.addEventListener("click",A),E.forEach(e=>{e.addEventListener("click",P)})}async function L(){try{if(console.log("Initiating PDF download..."),console.log("Rewrite data:",o),!o){a("No rewrite data available. Please try the process again.");return}if(!o.improved_resume_url){console.error("Missing improved_resume_url in rewrite data"),a("PDF download link not available. Please contact support.");return}const e=document.createElement("a");e.href=o.improved_resume_url,e.download=`improved_resume_${Date.now()}.pdf`,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),m("PDF download started! Check your downloads folder.")}catch(e){console.error("PDF download failed:",e),a("PDF download failed. Please try again or contact support.")}}async function F(){try{if(console.log("Initiating text download..."),!o){a("No rewrite data available. Please try the process again.");return}if(!o.improved_text_url){console.error("Missing improved_text_url in rewrite data"),a("Text download link not available. Please contact support.");return}const e=document.createElement("a");e.href=o.improved_text_url,e.download=`improved_resume_${Date.now()}.txt`,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),m("Text file download started! You can now format this however you like.")}catch(e){console.error("Text download failed:",e),a("Text download failed. Please try again or contact support.")}}function P(e){p=parseInt(e.currentTarget.dataset.rating),E.forEach(n=>{n.classList.remove("bg-primary-100","border-primary-500")}),e.currentTarget.classList.add("bg-primary-100","border-primary-500")}async function N(){var e;try{if(!p){a("Please select a rating");return}console.log("Submitting feedback...");const n=((e=(await S.auth.getUser()).data.user)==null?void 0:e.id)||"anonymous",i={rating:p.toString(),comment:I.value.trim(),category:"rewrite"};await v.saveFeedback(n,i),m("Thank you for your feedback!"),c.disabled=!0,c.textContent="Feedback Submitted"}catch(t){console.error("Feedback submission failed:",t),a("Failed to submit feedback. Please try again.")}}function R(){console.log("User wants new analysis"),sessionStorage.removeItem("atsAnalysis"),sessionStorage.removeItem("currentAnalysis"),sessionStorage.removeItem("upgradeAnalysis"),sessionStorage.removeItem("cvRewriteResult"),window.location.href="./index.html"}function $(){console.log("User going to home page"),window.location.href="./index.html"}function A(){console.log("User wants to optimize for specific job"),v.logActivity(null,"job_optimization_started",{original_score:(o==null?void 0:o.original_score)||"unknown",new_score:(o==null?void 0:o.new_score)||"unknown"}),o&&sessionStorage.setItem("currentRewriteData",JSON.stringify(o)),window.location.href="./job-input.html"}function m(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-success-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}function a(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}function O(){var e,t,n,i,d,f;if(o!=null&&o.debug){console.log("Debug data available:",o.debug);try{const s=document.getElementById("debugSection");s&&s.remove();const l=document.createElement("div");l.id="debugSection",l.className="mt-8 p-6 bg-gray-50 rounded-lg border border-gray-200";const r=o.debug;l.innerHTML=`
            <h3 class="text-lg font-bold text-gray-900 mb-4">üîç Debug Information</h3>
            
            <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div class="text-sm">
                    <div class="font-medium text-gray-700">Original Text:</div>
                    <div class="text-gray-600">${((e=r.text_analysis)==null?void 0:e.original_length)||0} characters, ${((t=r.text_analysis)==null?void 0:t.original_lines)||0} lines</div>
                </div>
                <div class="text-sm">
                    <div class="font-medium text-gray-700">Improved Text:</div>
                    <div class="text-gray-600">${((n=r.text_analysis)==null?void 0:n.improved_length)||0} characters, ${((i=r.text_analysis)==null?void 0:i.improved_lines)||0} lines</div>
                </div>
            </div>
            
            <div class="mb-4">
                <div class="text-sm">
                    <div class="font-medium text-gray-700">Content Preservation:</div>
                    <div class="text-gray-600">
                        Length ratio: ${Math.round((((d=r.text_analysis)==null?void 0:d.length_ratio)||0)*100)}%
                        ${(f=r.text_analysis)!=null&&f.content_preserved?'<span class="text-green-600 font-medium ml-2">‚úÖ Good preservation</span>':'<span class="text-red-600 font-medium ml-2">‚ö†Ô∏è Potential content loss</span>'}
                    </div>
                </div>
            </div>
            
            <div class="space-y-2">
                <h4 class="font-medium text-gray-700">Download Debug Files:</h4>
                <div class="grid md:grid-cols-3 gap-2">
                    <button id="downloadOriginalText" class="px-3 py-2 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200 transition-colors">
                        üìÑ Original Text
                    </button>
                    <button id="downloadImprovedText" class="px-3 py-2 bg-green-100 text-green-700 rounded text-sm hover:bg-green-200 transition-colors">
                        ‚ú® Improved Text
                    </button>
                    <button id="downloadComparison" class="px-3 py-2 bg-purple-100 text-purple-700 rounded text-sm hover:bg-purple-200 transition-colors">
                        üìä Comparison
                    </button>
                </div>
            </div>
        `,(document.querySelector(".max-w-4xl")||document.querySelector("main")||document.body).appendChild(l),z(r)}catch(s){console.error("Error displaying debug info:",s)}}}function z(e){const t=e.downloads||{},n=document.getElementById("downloadOriginalText");n&&t.original_text&&n.addEventListener("click",()=>{g(t.original_text.data_url,t.original_text.filename)});const i=document.getElementById("downloadImprovedText");i&&t.improved_text&&i.addEventListener("click",()=>{g(t.improved_text.data_url,t.improved_text.filename)});const d=document.getElementById("downloadComparison");d&&t.comparison&&d.addEventListener("click",()=>{g(t.comparison.data_url,t.comparison.filename)})}function g(e,t){try{const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),m(`Downloaded ${t}`)}catch(n){console.error("Download failed:",n),a("Download failed. Please try again.")}}function V(){try{typeof gtag<"u"&&gtag("event","page_view",{page_title:"Success Page",page_location:window.location.href}),o&&typeof gtag<"u"&&gtag("event","purchase",{transaction_id:o.payment_id||"unknown",value:29,currency:"USD"})}catch(e){console.error("Error tracking engagement:",e)}}document.addEventListener("DOMContentLoaded",()=>{B(),V()});
