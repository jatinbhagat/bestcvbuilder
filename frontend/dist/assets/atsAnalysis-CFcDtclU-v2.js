const d=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1",g=d?"https://bestcvbuilder-api.onrender.com/api":"/api",i=`${g}/cv-parser`,p="BUILD-2025-08-05-08:30:00-UI-FIXED";console.log("üîó API Configuration v1.1.0:",{API_BASE_URL:g,CV_PARSER_ENDPOINT:i});console.log("üö® CRITICAL: Verify this shows correct URL - should NOT be bestcvbuilder-gamma!");async function h(){console.log("üîç Testing API connectivity (non-blocking)...");let e=!1,n=!1;try{const o=new AbortController,r=setTimeout(()=>o.abort(),5e3),a=await fetch("https://bestcvbuilder-api.onrender.com/health",{method:"GET",mode:"cors",cache:"no-cache",signal:o.signal});clearTimeout(r),e=a.status===200,console.log(`${e?"‚úÖ":"‚ùå"} Health check: ${a.status}`)}catch(o){console.log(`‚ùå Health check failed: ${o.message}`)}try{const o=new AbortController,r=setTimeout(()=>o.abort(),3e3),a=await fetch(i,{method:"OPTIONS",mode:"cors",headers:{"Content-Type":"application/json"},signal:o.signal});clearTimeout(r),n=a.status===200,console.log(`${n?"‚úÖ":"‚ùå"} CORS preflight: ${a.status}`)}catch(o){console.log(`‚ùå CORS test failed: ${o.message}`)}const t=e||n;return console.log(`üìä Connectivity summary: Health=${e}, CORS=${n}, Overall=${t}`),t}async function u(e,n=null){try{console.log("Starting ATS analysis for file:",e),h().catch(s=>{console.warn("‚ö†Ô∏è Background connectivity test failed:",s.message)});const t={file_url:e,analysis_type:"ats_score",include_recommendations:!0};n&&(t.user_id=n,console.log("Including user_id for database saving:",n)),console.log("üöÄ Making request to:",i),console.log("üì§ Request body:",t);let o;const r=[{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)},{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}];let a;for(let s=0;s<r.length;s++)try{console.log(`üîÑ Attempt ${s+1}/3 with configuration:`,r[s]),o=await fetch(i,r[s]),console.log(`‚úÖ Attempt ${s+1} succeeded:`,o.status);break}catch(c){if(console.log(`‚ùå Attempt ${s+1} failed:`,c.message),a=c,s===r.length-1)throw a}if(console.log("üì® Response received:",o.status,o.statusText),!o.ok){let s=`API request failed: ${o.status}`;try{s=`API request failed: ${(await o.json()).error||o.statusText}`}catch{console.warn("Could not parse error response as JSON")}throw new Error(s)}const l=await o.json();return console.log("ATS analysis completed:",l),y(l,e)}catch(t){if(console.error("ATS analysis failed:",t),t.name==="TypeError"&&t.message.includes("Failed to fetch")){console.log("üîÑ Primary API failed, attempting diagnostics...");try{const r=await fetch("https://httpbin.org/ip");console.log("‚úÖ Internet connectivity confirmed, issue is with API endpoint")}catch{console.log("‚ùå No internet connectivity detected")}const o=new Error(`‚ùå Cannot connect to the resume analysis service.

üîç Technical Details:
‚Ä¢ Endpoint: ${i}
‚Ä¢ Error: ${t.message}

üõ†Ô∏è Possible Solutions:
‚Ä¢ Check your internet connection
‚Ä¢ Try refreshing the page
‚Ä¢ Disable VPN or proxy if using one
‚Ä¢ Try using a different browser
‚Ä¢ Contact support if the issue persists

üåê If you're on a corporate network, this service may be blocked by your firewall.`);throw o.name="NetworkError",o}throw t}}function y(e,n){return{score:e.ats_score||0,scoreCategory:m(e.ats_score),strengths:e.strengths||[],improvements:e.improvements||[],detailedAnalysis:e.detailed_analysis||"",keywords:e.keywords||[],missingKeywords:e.missing_keywords||[],formattingIssues:e.formatting_issues||[],suggestions:e.suggestions||[],originalFileUrl:n,file_url:e.file_url||n,content:e.content||"",timestamp:new Date().toISOString()}}function m(e){return e>=90?"excellent":e>=80?"good":e>=70?"fair":e>=60?"poor":"very_poor"}const f=async(e,n=null)=>u(e,n);export{g as A,p as B,i as C,f as a};
