import{S as A,s as B,D as u}from"./supabase-DQ_B3N6C-v2.js";import{C as b,A as w,B as m,a as T}from"./atsAnalysis-CFcDtclU-v2.js";async function P(t,e=null){try{if(console.log("Starting file upload:",t.name),!C(t))throw new Error("Invalid file type or size");const s=await A.uploadFile(t,e);return console.log("File uploaded successfully:",s),s}catch(s){throw console.error("File upload failed:",s),s.message&&s.message.includes("violates row-level security")?new Error("Storage access denied. Please contact support."):s}}function C(t){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(t.type))return console.error("Invalid file type:",t.type),!1;const s=10*1024*1024;return t.size>s?(console.error("File too large:",t.size),!1):!0}const E=document.getElementById("uploadForm"),r=document.getElementById("fileInput"),l=document.getElementById("analyzeBtn");document.getElementById("loadingState");const i=document.getElementById("uploadArea");function D(){console.log("BestCVBuilder initialized"),k(),H(),F(),J()}function F(){console.log("ðŸ—ï¸ BUILD INFO:",{BUILD_ID:m,API_BASE_URL:w,CV_PARSER_ENDPOINT:b});const t=document.createElement("div");t.id="build-info",t.style.cssText=`
        position: fixed; 
        bottom: 10px; 
        right: 10px; 
        background: #1f2937; 
        color: #10b981; 
        padding: 8px 12px; 
        border-radius: 6px; 
        font-family: monospace; 
        font-size: 11px; 
        z-index: 9999;
        border: 1px solid #10b981;
    `,t.textContent=`${m} | API: ${w}`,document.body.appendChild(t);const e=document.querySelector("h1");e&&(e.textContent=`BestCVBuilder [${m.slice(-10)}]`)}function k(){r&&r.addEventListener("change",z),E&&E.addEventListener("submit",_),document.addEventListener("resumeUpload",U),i&&(i.addEventListener("dragover",N),i.addEventListener("drop",O),i.addEventListener("dragenter",$),i.addEventListener("dragleave",q))}function z(t){const e=t.target.files[0];if(e&&g(e)){const s=document.getElementById("fileName"),n=document.getElementById("fileInfo");s&&(s.textContent=e.name),n&&n.classList.remove("hidden"),l&&(l.disabled=!1)}}async function _(t){t.preventDefault();const e=r?r.files[0]:null;if(!e){c("Please select a resume file");return}await x(e)}async function U(t){const{file:e}=t.detail;e&&g(e)&&await x(e)}function g(t){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(t.type))return c("Please upload a PDF, DOCX, or DOC file"),!1;const s=10*1024*1024;return t.size>s?(c("File size must be less than 10MB"),!1):(R(t),!0)}function R(t){const e=`${t.name} (${M(t.size)})`;console.log("File selected:",e)}function M(t){if(t===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,n)).toFixed(2))+" "+s[n]}async function x(t){try{console.log("ðŸš€ Starting resume processing for:",t.name),await u.logActivity(null,"file_upload_started",{filename:t.name,filesize:t.size,filetype:t.type}),I(!0),console.log("ðŸ“¤ Step 1: Uploading file to storage..."),V();const e=await P(t);console.log("âœ… File uploaded successfully:",e),await u.logActivity(null,"file_upload_completed",{filename:t.name,file_url:e}),console.log("ðŸ” Step 2: Starting ATS analysis..."),G();let s=null;try{const{data:{user:o}}=await B.auth.getUser();o?(s=o.id,console.log("User ID found for database saving:",s)):console.log("No user logged in - proceeding without database save")}catch(o){console.log("Error getting user:",o)}const n=await T(e,s);if(console.log("âœ… Analysis completed:",n),!n||!n.score)throw new Error("Invalid analysis result received");await u.logActivity(s,"ats_analysis_completed",{score:n.score,scoreCategory:n.scoreCategory,filename:t.name,analysis_id:n.id||`analysis_${Date.now()}`}),console.log("ðŸ’¾ Step 3: Storing results..."),sessionStorage.setItem("atsAnalysis",JSON.stringify(n)),console.log("ðŸ”€ Step 4: Redirecting to results..."),window.location.href="./result.html"}catch(e){console.error("Error processing resume:",e);let s="Failed to analyze resume. Please try again.";e.message.includes("upload")?s="File upload failed. Please check your connection and try again.":(e.message.includes("analysis")||e.message.includes("analyze"))&&(s="Resume analysis failed. Please try again in a moment."),c(s)}finally{I(!1)}}function N(t){t.preventDefault(),i.classList.add("dragover")}function $(t){t.preventDefault(),i.classList.add("dragover")}function q(t){t.preventDefault(),i.classList.remove("dragover")}function O(t){t.preventDefault(),i.classList.remove("dragover");const e=t.dataTransfer.files;if(e.length>0){const s=e[0];if(r){const n=new DataTransfer;n.items.add(s),r.files=n.files}if(g(s)){const n=document.getElementById("fileName"),o=document.getElementById("fileInfo");n&&(n.textContent=s.name),o&&o.classList.remove("hidden"),l&&(l.disabled=!1)}}}class Y{constructor(){this.currentStep=0,this.steps=["upload","structure","contact","keywords","experience","education","ats","recommendations"],this.isActive=!1}show(){const e=document.getElementById("atsLoadingScreen");e?(e.classList.remove("hidden"),this.isActive=!0,this.resetProgress()):console.warn("ATS Loading Screen element not found - falling back to basic loading")}hide(){const e=document.getElementById("atsLoadingScreen");e&&(e.classList.add("hidden"),this.isActive=!1)}resetProgress(){this.currentStep=0,this.updateProgress(0),this.updateTimeRemaining(30),this.steps.forEach((e,s)=>{const n=document.getElementById(`check-${e}`);if(n){const o=n.querySelector(".loading-spinner"),a=n.querySelector(".check-icon");s===0?(n.style.opacity="1",o&&o.classList.remove("hidden"),a&&a.classList.add("hidden")):(n.style.opacity="0.5",o&&o.classList.add("hidden"),a&&a.classList.add("hidden"))}})}completeStep(e){const s=this.steps.indexOf(e);if(s===-1)return;const n=document.getElementById(`check-${e}`);if(n){const h=n.querySelector(".loading-spinner"),y=n.querySelector(".check-icon");h&&h.classList.add("hidden"),y&&y.classList.remove("hidden"),n.style.opacity="1";const v=s+1;if(v<this.steps.length){const L=this.steps[v],d=document.getElementById(`check-${L}`);if(d){const S=d.querySelector(".loading-spinner");d.style.opacity="1",S&&S.classList.remove("hidden")}}}const o=Math.round((s+1)/this.steps.length*100);this.updateProgress(o);const a=Math.max(2,30-(s+1)*4);this.updateTimeRemaining(a)}updateProgress(e){const s=document.getElementById("progressBar"),n=document.getElementById("progressText");s&&(s.style.width=`${e}%`),n&&(n.textContent=`${e}%`)}updateTimeRemaining(e){const s=document.getElementById("timeRemaining");s&&(s.textContent=`${e} seconds`)}async startAnalysisSequence(){this.isActive&&(await this.delay(2e3),this.completeStep("upload"),this.isActive&&(await this.delay(3e3),this.completeStep("structure"),this.isActive&&(await this.delay(2500),this.completeStep("contact"),this.isActive&&(await this.delay(4e3),this.completeStep("keywords"),this.isActive&&(await this.delay(3500),this.completeStep("experience"),this.isActive&&(await this.delay(2e3),this.completeStep("education"),this.isActive&&(await this.delay(3e3),this.completeStep("ats"),this.isActive&&(await this.delay(2500),this.completeStep("recommendations"),this.isActive&&(this.updateProgress(100),this.updateTimeRemaining(0))))))))))}delay(e){return new Promise(s=>setTimeout(s,e))}}const f=new Y;function I(t){const e=document.getElementById("buttonText"),s=document.getElementById("loadingText");if(t){try{f.show(),f.startAnalysisSequence()}catch(n){console.warn("ATS loading screen error, falling back to simple loading:",n)}e&&(e.style.display="none"),s&&(s.style.display="flex"),l&&(l.disabled=!0)}else{try{f.hide()}catch(n){console.warn("Error hiding ATS loading screen:",n)}e&&(e.style.display="inline"),s&&(s.style.display="none"),l&&(l.disabled=!1)}}function V(){console.log("ðŸ“¤ Upload progress started")}function G(){console.log("ðŸ” Analysis in progress")}function c(t){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.remove()},5e3)}async function H(){try{const{data:{session:t}}=await B.auth.getSession();t&&console.log("User session found:",t.user.email)}catch(t){console.error("Error checking session:",t)}}function J(){const t=document.getElementById("testingControls"),e=document.getElementById("enableBypassBtn"),s=document.getElementById("disableBypassBtn"),n=window.location.hostname,o=n==="localhost"||n==="127.0.0.1"||n.includes("localhost")||n.includes("preview")||n.includes("render.com")||n.includes("onrender.com")||n.includes("vercel.app");if(console.log("ðŸ” Testing controls check:"),console.log("  - Current hostname:",n),console.log("  - Show testing controls:",o),o){t&&t.classList.remove("hidden");const a=sessionStorage.getItem("BYPASS_PAYMENT")==="true";p(a),e&&e.addEventListener("click",()=>{sessionStorage.setItem("BYPASS_PAYMENT","true"),p(!0),showSuccess("Payment bypass enabled for testing!")}),s&&s.addEventListener("click",()=>{sessionStorage.removeItem("BYPASS_PAYMENT"),p(!1),showSuccess("Payment bypass disabled")})}}function p(t){const e=document.getElementById("enableBypassBtn"),s=document.getElementById("disableBypassBtn");t?(e==null||e.classList.add("hidden"),s==null||s.classList.remove("hidden")):(e==null||e.classList.remove("hidden"),s==null||s.classList.add("hidden"))}document.addEventListener("DOMContentLoaded",D);
