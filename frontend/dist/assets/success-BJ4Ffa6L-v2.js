import{s as y,D as p}from"./supabase-6siEAxIw-v2.js";/* empty css                  */const c=document.getElementById("originalScore"),d=document.getElementById("newScore"),i=document.getElementById("improvement"),l=document.getElementById("downloadBtn"),r=document.getElementById("submitFeedbackBtn"),m=document.getElementById("newAnalysisBtn"),u=document.getElementById("homeBtn"),b=document.getElementById("feedbackComment"),g=document.querySelectorAll(".rating-btn");let n=null,s=null;function h(){console.log("Success page initialized"),v(),E()}function v(){try{const e=sessionStorage.getItem("cvRewriteResult");if(!e){console.warn("No CV rewrite data found"),a("No CV rewrite data available.");return}n=JSON.parse(e),console.log("Loaded CV rewrite data:",n),k()}catch(e){console.error("Error loading CV rewrite data:",e),a("Failed to load CV rewrite results.")}}function k(){if(!n)return;const e=n.original_score||0,t=n.new_score||0,o=n.score_improvement||0;c&&(c.textContent=e),d&&(d.textContent=t),i&&(i.textContent=`+${o}`,i.className=o>0?"text-lg font-semibold text-success-600":"text-lg font-semibold text-gray-600")}function E(){l&&l.addEventListener("click",S),r&&r.addEventListener("click",x),m&&m.addEventListener("click",B),u&&u.addEventListener("click",D),g.forEach(e=>{e.addEventListener("click",C)})}async function S(){try{if(console.log("Initiating resume download..."),!n||!n.improved_resume_url){a("Download link not available. Please check your email.");return}const e=document.createElement("a");e.href=n.improved_resume_url,e.download=`improved_resume_${Date.now()}.pdf`,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),f("Download started! Check your downloads folder.")}catch(e){console.error("Download failed:",e),a("Download failed. Please try again or check your email.")}}function C(e){s=parseInt(e.currentTarget.dataset.rating),g.forEach(o=>{o.classList.remove("bg-primary-100","border-primary-500")}),e.currentTarget.classList.add("bg-primary-100","border-primary-500")}async function x(){var e;try{if(!s){a("Please select a rating");return}console.log("Submitting feedback...");const o=((e=(await y.auth.getUser()).data.user)==null?void 0:e.id)||"anonymous",w={rating:s.toString(),comment:b.value.trim(),category:"rewrite"};await p.saveFeedback(o,w),f("Thank you for your feedback!"),r.disabled=!0,r.textContent="Feedback Submitted"}catch(t){console.error("Feedback submission failed:",t),a("Failed to submit feedback. Please try again.")}}function B(){console.log("User wants new analysis"),sessionStorage.removeItem("atsAnalysis"),sessionStorage.removeItem("currentAnalysis"),sessionStorage.removeItem("upgradeAnalysis"),sessionStorage.removeItem("cvRewriteResult"),window.location.href="./index.html"}function D(){console.log("User going to home page"),window.location.href="./index.html"}function f(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-success-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}function a(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}function I(){try{typeof gtag<"u"&&gtag("event","page_view",{page_title:"Success Page",page_location:window.location.href}),n&&typeof gtag<"u"&&gtag("event","purchase",{transaction_id:n.payment_id||"unknown",value:29,currency:"USD"})}catch(e){console.error("Error tracking engagement:",e)}}document.addEventListener("DOMContentLoaded",()=>{h(),I()});
