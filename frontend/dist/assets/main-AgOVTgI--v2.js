import{S as h,s as p}from"./supabase-6siEAxIw-v2.js";/* empty css                  */async function v(e,o=null){try{if(console.log("Starting file upload:",e.name),!w(e))throw new Error("Invalid file type or size");const t=await h.uploadFile(e,o);return console.log("File uploaded successfully:",t),t}catch(t){throw console.error("File upload failed:",t),t.message&&t.message.includes("violates row-level security")?new Error("Storage access denied. Please contact support."):t}}function w(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return console.error("Invalid file type:",e.type),!1;const t=10*1024*1024;return e.size>t?(console.error("File too large:",e.size),!1):!0}const I=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1",r=I?"https://bestcvbuilder-api.onrender.com/api":"/api",u=`${r}/cv-parser`,c="BUILD-2025-08-04-08:00:00-RENDER-API";console.log("ðŸ”— API Configuration v1.1.0:",{API_BASE_URL:r,CV_PARSER_ENDPOINT:u});console.log("ðŸš¨ CRITICAL: Verify this shows correct URL - should NOT be bestcvbuilder-gamma!");async function E(e,o=null){try{console.log("Starting ATS analysis for file:",e);const t={file_url:e,analysis_type:"ats_score",include_recommendations:!0};o&&(t.user_id=o,console.log("Including user_id for database saving:",o));const n=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`API request failed: ${n.status}`);const s=await n.json();return console.log("ATS analysis completed:",s),S(s)}catch(t){throw console.error("ATS analysis failed:",t),t}}function S(e){return{score:e.ats_score||0,scoreCategory:b(e.ats_score),strengths:e.strengths||[],improvements:e.improvements||[],detailedAnalysis:e.detailed_analysis||"",keywords:e.keywords||[],missingKeywords:e.missing_keywords||[],formattingIssues:e.formatting_issues||[],suggestions:e.suggestions||[],timestamp:new Date().toISOString()}}function b(e){return e>=90?"excellent":e>=80?"good":e>=70?"fair":e>=60?"poor":"very_poor"}const x=async(e,o=null)=>E(e,o),g=document.getElementById("uploadForm"),l=document.getElementById("fileInput"),a=document.getElementById("analyzeBtn");document.getElementById("loadingState");const i=document.getElementById("uploadArea");function B(){console.log("BestCVBuilder initialized"),F(),M(),D()}function D(){console.log("ðŸ—ï¸ BUILD INFO:",{BUILD_ID:c,API_BASE_URL:r,CV_PARSER_ENDPOINT:u});const e=document.createElement("div");e.id="build-info",e.style.cssText=`
        position: fixed; 
        bottom: 10px; 
        right: 10px; 
        background: #1f2937; 
        color: #10b981; 
        padding: 8px 12px; 
        border-radius: 6px; 
        font-family: monospace; 
        font-size: 11px; 
        z-index: 9999;
        border: 1px solid #10b981;
    `,e.textContent=`${c} | API: ${r}`,document.body.appendChild(e);const o=document.querySelector("h1");o&&(o.textContent=`BestCVBuilder [${c.slice(-10)}]`)}function F(){l&&l.addEventListener("change",L),g&&g.addEventListener("submit",T),document.addEventListener("resumeUpload",A),i&&(i.addEventListener("dragover",P),i.addEventListener("drop",N),i.addEventListener("dragenter",_),i.addEventListener("dragleave",U))}function L(e){const o=e.target.files[0];if(o&&f(o)){const t=document.getElementById("fileName"),n=document.getElementById("fileInfo");t&&(t.textContent=o.name),n&&n.classList.remove("hidden"),a&&(a.disabled=!1)}}async function T(e){e.preventDefault();const o=l?l.files[0]:null;if(!o){d("Please select a resume file");return}await y(o)}async function A(e){const{file:o}=e.detail;o&&f(o)&&await y(o)}function f(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return d("Please upload a PDF, DOCX, or DOC file"),!1;const t=10*1024*1024;return e.size>t?(d("File size must be less than 10MB"),!1):(C(e),!0)}function C(e){const o=`${e.name} (${z(e.size)})`;console.log("File selected:",o)}function z(e){if(e===0)return"0 Bytes";const o=1024,t=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(o));return parseFloat((e/Math.pow(o,n)).toFixed(2))+" "+t[n]}async function y(e){try{console.log("ðŸš€ Starting resume processing for:",e.name),m(!0),console.log("ðŸ“¤ Step 1: Uploading file to storage..."),O();const o=await v(e);console.log("âœ… File uploaded successfully:",o),console.log("ðŸ” Step 2: Starting ATS analysis..."),k();let t=null;try{const{data:{user:s}}=await p.auth.getUser();s?(t=s.id,console.log("User ID found for database saving:",t)):console.log("No user logged in - proceeding without database save")}catch(s){console.log("Error getting user:",s)}const n=await x(o,t);if(console.log("âœ… Analysis completed:",n),!n||!n.score)throw new Error("Invalid analysis result received");console.log("ðŸ’¾ Step 3: Storing results..."),sessionStorage.setItem("atsAnalysis",JSON.stringify(n)),console.log("ðŸ”€ Step 4: Redirecting to results..."),window.location.href="./result.html"}catch(o){console.error("Error processing resume:",o);let t="Failed to analyze resume. Please try again.";o.message.includes("upload")?t="File upload failed. Please check your connection and try again.":(o.message.includes("analysis")||o.message.includes("analyze"))&&(t="Resume analysis failed. Please try again in a moment."),d(t)}finally{m(!1)}}function P(e){e.preventDefault(),i.classList.add("dragover")}function _(e){e.preventDefault(),i.classList.add("dragover")}function U(e){e.preventDefault(),i.classList.remove("dragover")}function N(e){e.preventDefault(),i.classList.remove("dragover");const o=e.dataTransfer.files;if(o.length>0){const t=o[0];if(l){const n=new DataTransfer;n.items.add(t),l.files=n.files}if(f(t)){const n=document.getElementById("fileName"),s=document.getElementById("fileInfo");n&&(n.textContent=t.name),s&&s.classList.remove("hidden"),a&&(a.disabled=!1)}}}function m(e){const o=document.getElementById("buttonText"),t=document.getElementById("loadingText");e?(o&&(o.style.display="none"),t&&(t.style.display="flex"),a&&(a.disabled=!0)):(o&&(o.style.display="inline"),t&&(t.style.display="none"),a&&(a.disabled=!1))}function O(){console.log("ðŸ“¤ Upload progress started")}function k(){console.log("ðŸ” Analysis in progress")}function d(e){const o=document.createElement("div");o.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.remove()},5e3)}async function M(){try{const{data:{session:e}}=await p.auth.getSession();e&&console.log("User session found:",e.user.email)}catch(e){console.error("Error checking session:",e)}}document.addEventListener("DOMContentLoaded",B);
