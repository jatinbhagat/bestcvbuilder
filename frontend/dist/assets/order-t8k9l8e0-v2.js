import"./modulepreload-polyfill-B5Qt9EMX-v2.js";/* empty css                  */let d=null,o=null,u=null;document.addEventListener("DOMContentLoaded",function(){console.log("üõí Initializing order creation page..."),v(),S()});function v(){try{let e=sessionStorage.getItem("pendingAnalysis")||sessionStorage.getItem("atsAnalysis");e?(d=JSON.parse(e),console.log("üìä Analysis data loaded:",d),g()):(console.error("‚ùå No analysis data found"),s("No resume analysis data found. Please go back and analyze your resume first."))}catch(e){console.error("‚ùå Error loading analysis data:",e),s("Failed to load resume data. Please try again.")}}async function g(){try{console.log("üîç Creating order with contact extraction...");const e=await fetch("/api/orders/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({analysis_data:d})});if(!e.ok)throw new Error(`Order creation failed: ${e.status}`);const t=await e.json();console.log("‚úÖ Order created:",t),u=t.order,o=t.contact_info,P()}catch(e){console.error("‚ùå Order creation error:",e),s("Failed to create order. Please try again.")}}function P(){try{const e=document.getElementById("email"),t=document.getElementById("phone"),n=document.getElementById("phoneSelect"),r=document.getElementById("contactInfoAlert"),a=document.getElementById("extractedInfoText");let l="";o.emails&&o.emails.length>0&&(e.value=o.primary_email||o.emails[0],l+=`üìß ${o.emails.length} email${o.emails.length>1?"s":""} found. `,o.emails.length>1&&(l+=`(Options: ${o.emails.join(", ")}) `)),o.phone_numbers&&o.phone_numbers.length>0&&(o.phone_numbers.length===1?(t.value=o.primary_phone||o.phone_numbers[0],l+="üì± Phone number found."):(n.style.display="block",t.style.display="none",n.innerHTML='<option value="">Select a phone number</option>',o.phone_numbers.forEach(i=>{const c=document.createElement("option");c.value=i,c.textContent=i,n.appendChild(c)}),o.primary_phone&&(n.value=o.primary_phone),l+=`üì± ${o.phone_numbers.length} phone numbers found. Please select one.`)),l&&(a.textContent=l,r.style.display="block"),console.log("üìù Contact information populated")}catch(e){console.error("‚ùå Error populating contact info:",e)}}function S(){const e=document.getElementById("orderForm"),t=document.getElementById("phoneSelect");e.addEventListener("submit",L),t.addEventListener("change",function(){const a=document.getElementById("phone");a.value=this.value});const n=document.getElementById("email"),r=document.getElementById("phone");n.addEventListener("blur",h),r.addEventListener("blur",f)}function h(){const e=document.getElementById("email"),t=document.getElementById("emailError"),n=e.value.trim();return n?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?(E(e,t),!0):(m(e,t,"Please enter a valid email address"),!1):(m(e,t,"Email address is required"),!1)}function f(){const e=document.getElementById("phone"),t=document.getElementById("phoneSelect"),n=document.getElementById("phoneError"),r=t.style.display==="block"?t.value:e.value.trim();if(!r){const i=t.style.display==="block"?t:e;return m(i,n,"Mobile number is required"),!1}if(r.replace(/\D/g,"").length<10){const i=t.style.display==="block"?t:e;return m(i,n,"Please enter a valid mobile number"),!1}const l=t.style.display==="block"?t:e;return E(l,n),!0}function m(e,t,n){e.classList.add("error"),t.textContent=n}function E(e,t){e.classList.remove("error"),t.textContent=""}async function L(e){e.preventDefault();try{console.log("üöÄ Processing order submission...");const t=h(),n=f(),r=document.getElementById("termsCheck"),a=document.getElementById("termsError");let l=!0;if(r.checked?a.textContent="":(a.textContent="Please accept the terms and conditions",l=!1),!t||!n||!l){console.log("‚ùå Form validation failed");return}x();const i=document.getElementById("email"),c=document.getElementById("phone"),y=document.getElementById("phoneSelect"),B=i.value.trim(),b=y.style.display==="block"?y.value:c.value.trim();await I({order_id:u.order_id,email:B,phone:b})}catch(t){console.error("‚ùå Order submission error:",t),p(),s("Failed to process order. Please try again.")}}async function I(e){try{console.log("üí≥ Initiating PayU payment...");const t=await fetch("/api/orders/initiate-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Payment initiation failed: ${t.status}`);const n=await t.json();console.log("‚úÖ Payment data received:",n),w(n.payment_data,n.payu_url)}catch(t){console.error("‚ùå Payment initiation error:",t),p(),s("Failed to initiate payment. Please try again.")}}function w(e,t){try{console.log("üîÑ Redirecting to PayU...");const n=document.getElementById("payuForm");n.action=t,n.innerHTML="",Object.keys(e).forEach(r=>{const a=document.createElement("input");a.type="hidden",a.name=r,a.value=e[r],n.appendChild(a)}),sessionStorage.setItem("currentOrderId",u.order_id),sessionStorage.setItem("paymentInitiated","true"),n.submit(),console.log("‚úÖ Redirected to PayU payment gateway")}catch(n){console.error("‚ùå PayU redirection error:",n),p(),s("Failed to redirect to payment gateway. Please try again.")}}function x(){const e=document.getElementById("payButton"),t=document.getElementById("payButtonText"),n=document.getElementById("payButtonLoader");e.disabled=!0,t.style.display="none",n.style.display="inline-block",e.classList.add("loading")}function p(){const e=document.getElementById("payButton"),t=document.getElementById("payButtonText"),n=document.getElementById("payButtonLoader");e.disabled=!1,t.style.display="inline",n.style.display="none",e.classList.remove("loading")}function s(e){alert(e),console.error("‚ùå Error:",e)}window.debugOrderPage={analysisData:d,contactInfo:o,currentOrder:u,createOrderWithContactExtraction:g,initiatePayment:I};
