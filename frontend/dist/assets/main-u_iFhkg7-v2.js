import{S as b,s as I,D as g}from"./supabase-DQ_B3N6C-v2.js";import{C as x,A as S,B as f,a as A}from"./atsAnalysis-CFcDtclU-v2.js";async function T(t,e=null){try{if(console.log("Starting file upload:",t.name),!P(t))throw new Error("Invalid file type or size");const s=await b.uploadFile(t,e);return console.log("File uploaded successfully:",s),s}catch(s){throw console.error("File upload failed:",s),s.message&&s.message.includes("violates row-level security")?new Error("Storage access denied. Please contact support."):s}}function P(t){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(t.type))return console.error("Invalid file type:",t.type),!1;const s=10*1024*1024;return t.size>s?(console.error("File too large:",t.size),!1):!0}const E=document.getElementById("uploadForm"),l=document.getElementById("fileInput"),a=document.getElementById("analyzeBtn");document.getElementById("loadingState");const i=document.getElementById("uploadArea");function D(){console.log("BestCVBuilder initialized"),F(),G(),C(),H()}function C(){console.log("ðŸ—ï¸ BUILD INFO:",{BUILD_ID:f,API_BASE_URL:S,CV_PARSER_ENDPOINT:x});const t=document.createElement("div");t.id="build-info",t.style.cssText=`
        position: fixed; 
        bottom: 10px; 
        right: 10px; 
        background: #1f2937; 
        color: #10b981; 
        padding: 8px 12px; 
        border-radius: 6px; 
        font-family: monospace; 
        font-size: 11px; 
        z-index: 9999;
        border: 1px solid #10b981;
    `,t.textContent=`${f} | API: ${S}`,document.body.appendChild(t);const e=document.querySelector("h1");e&&(e.textContent=`BestCVBuilder [${f.slice(-10)}]`)}function F(){l&&l.addEventListener("change",z),E&&E.addEventListener("submit",_),document.addEventListener("resumeUpload",U),i&&(i.addEventListener("dragover",N),i.addEventListener("drop",$),i.addEventListener("dragenter",k),i.addEventListener("dragleave",O))}function z(t){const e=t.target.files[0];if(e&&h(e)){const s=document.getElementById("fileName"),n=document.getElementById("fileInfo");s&&(s.textContent=e.name),n&&n.classList.remove("hidden"),a&&(a.disabled=!1)}}async function _(t){t.preventDefault();const e=l?l.files[0]:null;if(!e){r("Please select a resume file");return}await B(e)}async function U(t){const{file:e}=t.detail;e&&h(e)&&await B(e)}function h(t){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(t.type))return r("Please upload a PDF, DOCX, or DOC file"),!1;const s=10*1024*1024;return t.size>s?(r("File size must be less than 10MB"),!1):(R(t),!0)}function R(t){const e=`${t.name} (${M(t.size)})`;console.log("File selected:",e)}function M(t){if(t===0)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,n)).toFixed(2))+" "+s[n]}async function B(t){try{console.log("ðŸš€ Starting resume processing for:",t.name),await g.logActivity(null,"file_upload_started",{filename:t.name,filesize:t.size,filetype:t.type}),w(!0),console.log("ðŸ“¤ Step 1: Uploading file to storage..."),Y();const e=await T(t);console.log("âœ… File uploaded successfully:",e),await g.logActivity(null,"file_upload_completed",{filename:t.name,file_url:e}),console.log("ðŸ” Step 2: Starting ATS analysis..."),V();let s=null;try{const{data:{user:o}}=await I.auth.getUser();o?(s=o.id,console.log("User ID found for database saving:",s)):console.log("No user logged in - proceeding without database save")}catch(o){console.log("Error getting user:",o)}const n=await A(e,s);if(console.log("âœ… Analysis completed:",n),!n||!n.score)throw new Error("Invalid analysis result received");await g.logActivity(s,"ats_analysis_completed",{score:n.score,scoreCategory:n.scoreCategory,filename:t.name,analysis_id:n.id||`analysis_${Date.now()}`}),console.log("ðŸ’¾ Step 3: Storing results..."),sessionStorage.setItem("atsAnalysis",JSON.stringify(n)),console.log("ðŸ”€ Step 4: Redirecting to results..."),window.location.href="./result.html"}catch(e){console.error("Error processing resume:",e);let s="Failed to analyze resume. Please try again.";e.message.includes("upload")?s="File upload failed. Please check your connection and try again.":(e.message.includes("analysis")||e.message.includes("analyze"))&&(s="Resume analysis failed. Please try again in a moment."),r(s)}finally{w(!1)}}function N(t){t.preventDefault(),i.classList.add("dragover")}function k(t){t.preventDefault(),i.classList.add("dragover")}function O(t){t.preventDefault(),i.classList.remove("dragover")}function $(t){t.preventDefault(),i.classList.remove("dragover");const e=t.dataTransfer.files;if(e.length>0){const s=e[0];if(l){const n=new DataTransfer;n.items.add(s),l.files=n.files}if(h(s)){const n=document.getElementById("fileName"),o=document.getElementById("fileInfo");n&&(n.textContent=s.name),o&&o.classList.remove("hidden"),a&&(a.disabled=!1)}}}class q{constructor(){this.currentStep=0,this.steps=["step-1","step-2","step-3"],this.isActive=!1}show(){const e=document.getElementById("atsLoadingScreen");e?(e.classList.remove("hidden"),this.isActive=!0,this.resetProgress()):console.warn("ATS Loading Screen element not found - falling back to basic loading")}hide(){const e=document.getElementById("atsLoadingScreen");e&&(e.classList.add("hidden"),this.isActive=!1)}resetProgress(){this.currentStep=0,this.updateProgress(0),this.updateTimeRemaining("few seconds"),this.steps.forEach((e,s)=>{const n=document.getElementById(e);if(n){const o=n.querySelector(".loading-dot");s===0?(n.style.opacity="1",o&&(o.classList.add("bg-blue-500"),o.classList.remove("bg-gray-500"),o.classList.add("animate-pulse"))):(n.style.opacity="0.4",o&&(o.classList.add("bg-gray-500"),o.classList.remove("bg-blue-500"),o.classList.remove("animate-pulse"))),n.classList.remove("step-complete")}})}completeStep(e){const s=this.steps.indexOf(e);if(s===-1)return;const n=document.getElementById(e);if(n){const c=n.querySelector(".loading-dot");n.classList.add("step-complete"),n.style.opacity="1",c&&(c.classList.remove("animate-pulse","bg-blue-500","bg-gray-500"),c.classList.add("bg-green-500"));const v=s+1;if(v<this.steps.length){const L=this.steps[v],u=document.getElementById(L);if(u){const m=u.querySelector(".loading-dot");u.style.opacity="1",m&&(m.classList.add("bg-blue-500","animate-pulse"),m.classList.remove("bg-gray-500"))}}}const o=Math.round((s+1)/this.steps.length*100);this.updateProgress(o);const d=s===this.steps.length-1?"ready!":"few seconds";this.updateTimeRemaining(d)}updateProgress(e){const s=document.getElementById("progressBar"),n=document.getElementById("progressText");s&&(s.style.width=`${e}%`),n&&(n.textContent=`${e}%`)}updateTimeRemaining(e){const s=document.getElementById("timeRemaining");s&&(s.textContent=e)}async startAnalysisSequence(){this.isActive&&(await this.delay(1500),this.completeStep("step-1"),this.isActive&&(await this.delay(2e3),this.completeStep("step-2"),this.isActive&&(await this.delay(1e3),this.completeStep("step-3"),this.isActive&&(this.updateProgress(100),this.updateTimeRemaining("ready!")))))}delay(e){return new Promise(s=>setTimeout(s,e))}}const p=new q;function w(t){const e=document.getElementById("buttonText"),s=document.getElementById("loadingText");if(t){try{p.show(),p.startAnalysisSequence()}catch(n){console.warn("ATS loading screen error, falling back to simple loading:",n)}e&&(e.style.display="none"),s&&(s.style.display="flex"),a&&(a.disabled=!0)}else{try{p.hide()}catch(n){console.warn("Error hiding ATS loading screen:",n)}e&&(e.style.display="inline"),s&&(s.style.display="none"),a&&(a.disabled=!1)}}function Y(){console.log("ðŸ“¤ Upload progress started")}function V(){console.log("ðŸ” Analysis in progress")}function r(t){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.remove()},5e3)}async function G(){try{const{data:{session:t}}=await I.auth.getSession();t&&console.log("User session found:",t.user.email)}catch(t){console.error("Error checking session:",t)}}function H(){const t=document.getElementById("testingControls"),e=document.getElementById("enableBypassBtn"),s=document.getElementById("disableBypassBtn"),n=window.location.hostname,o=n==="localhost"||n==="127.0.0.1"||n.includes("localhost")||n.includes("preview")||n.includes("render.com")||n.includes("onrender.com")||n.includes("vercel.app");if(console.log("ðŸ” Testing controls check:"),console.log("  - Current hostname:",n),console.log("  - Show testing controls:",o),o){t&&t.classList.remove("hidden");const d=sessionStorage.getItem("BYPASS_PAYMENT")==="true";y(d),e&&e.addEventListener("click",()=>{sessionStorage.setItem("BYPASS_PAYMENT","true"),y(!0),showSuccess("Payment bypass enabled for testing!")}),s&&s.addEventListener("click",()=>{sessionStorage.removeItem("BYPASS_PAYMENT"),y(!1),showSuccess("Payment bypass disabled")})}}function y(t){const e=document.getElementById("enableBypassBtn"),s=document.getElementById("disableBypassBtn");t?(e==null||e.classList.add("hidden"),s==null||s.classList.remove("hidden")):(e==null||e.classList.remove("hidden"),s==null||s.classList.add("hidden"))}document.addEventListener("DOMContentLoaded",D);
