const p=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1",h=p?"https://bestcvbuilder-api.onrender.com/api":"/api",i=`${h}/cv-parser`,m="BUILD-2025-08-05-08:30:00-UI-FIXED";console.log("üîó API Configuration v1.1.0:",{API_BASE_URL:h,CV_PARSER_ENDPOINT:i});console.log("üö® CRITICAL: Verify this shows correct URL - should NOT be bestcvbuilder-gamma!");async function g(){try{console.log("üîç Testing API connectivity...");const e=await fetch("https://bestcvbuilder-api.onrender.com/health",{method:"GET",mode:"cors",cache:"no-cache"});console.log("‚úÖ Health check response:",e.status);const n=await fetch(i,{method:"OPTIONS",mode:"cors",headers:{"Content-Type":"application/json"}});console.log("‚úÖ CORS preflight response:",n.status);try{const s=await fetch("https://bestcvbuilder-api.onrender.com/api/test-connectivity",{method:"GET",mode:"cors",cache:"no-cache"});console.log("‚úÖ Test connectivity response:",s.status)}catch(s){console.log("‚ö†Ô∏è Test connectivity endpoint not available yet:",s.message)}return!0}catch(e){return console.error("‚ùå API connectivity test failed:",e),!1}}async function y(e,n=null){try{if(console.log("Starting ATS analysis for file:",e),!await g())throw new Error("API connectivity test failed. Cannot proceed with analysis.");const r={file_url:e,analysis_type:"ats_score",include_recommendations:!0};n&&(r.user_id=n,console.log("Including user_id for database saving:",n)),console.log("üöÄ Making request to:",i),console.log("üì§ Request body:",r);let t;const a=[{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)},{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}];let l;for(let o=0;o<a.length;o++)try{console.log(`üîÑ Attempt ${o+1}/3 with configuration:`,a[o]),t=await fetch(i,a[o]),console.log(`‚úÖ Attempt ${o+1} succeeded:`,t.status);break}catch(c){if(console.log(`‚ùå Attempt ${o+1} failed:`,c.message),l=c,o===a.length-1)throw l}if(console.log("üì® Response received:",t.status,t.statusText),!t.ok){let o=`API request failed: ${t.status}`;try{o=`API request failed: ${(await t.json()).error||t.statusText}`}catch{console.warn("Could not parse error response as JSON")}throw new Error(o)}const d=await t.json();return console.log("ATS analysis completed:",d),u(d,e)}catch(s){if(console.error("ATS analysis failed:",s),s.name==="TypeError"&&s.message.includes("Failed to fetch")){console.log("üîÑ Primary API failed, attempting diagnostics...");try{const t=await fetch("https://httpbin.org/ip");console.log("‚úÖ Internet connectivity confirmed, issue is with API endpoint")}catch{console.log("‚ùå No internet connectivity detected")}const r=new Error(`‚ùå Cannot connect to the resume analysis service.

üîç Technical Details:
‚Ä¢ Endpoint: ${i}
‚Ä¢ Error: ${s.message}

üõ†Ô∏è Possible Solutions:
‚Ä¢ Check your internet connection
‚Ä¢ Try refreshing the page
‚Ä¢ Disable VPN or proxy if using one
‚Ä¢ Try using a different browser
‚Ä¢ Contact support if the issue persists

üåê If you're on a corporate network, this service may be blocked by your firewall.`);throw r.name="NetworkError",r}throw s}}function u(e,n){return{score:e.ats_score||0,scoreCategory:f(e.ats_score),strengths:e.strengths||[],improvements:e.improvements||[],detailedAnalysis:e.detailed_analysis||"",keywords:e.keywords||[],missingKeywords:e.missing_keywords||[],formattingIssues:e.formatting_issues||[],suggestions:e.suggestions||[],originalFileUrl:n,file_url:e.file_url||n,content:e.content||"",timestamp:new Date().toISOString()}}function f(e){return e>=90?"excellent":e>=80?"good":e>=70?"fair":e>=60?"poor":"very_poor"}const T=async(e,n=null)=>y(e,n);export{h as A,m as B,i as C,T as a};
