import"./modulepreload-polyfill-B5Qt9EMX-v2.js";/* empty css                  */import{S as L,s as A,D as h}from"./supabase-TKoVn4-v-v2.js";async function B(e,t=null){try{if(console.log("Starting file upload:",e.name),!x(e))throw new Error("Invalid file type or size");const s=await L.uploadFile(e,t);return console.log("File uploaded successfully:",s),s}catch(s){throw console.error("File upload failed:",s),s.message&&s.message.includes("violates row-level security")?new Error("Storage access denied. Please contact support."):s}}function x(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return console.error("Invalid file type:",e.type),!1;const s=10*1024*1024;return e.size>s?(console.error("File too large:",e.size),!1):!0}const P=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1",f=P?"https://bestcvbuilder-api.onrender.com/api":"/api",p=`${f}/cv-parser`,v="BUILD-2025-08-05-08:30:00-UI-FIXED";console.log("🔗 API Configuration v1.1.0:",{API_BASE_URL:f,CV_PARSER_ENDPOINT:p});console.log("🚨 CRITICAL: Verify this shows correct URL - should NOT be bestcvbuilder-gamma!");async function C(e,t=null){try{console.log("Starting ATS analysis for file:",e),console.log("📡 Skipping connectivity test during analysis to prevent conflicts");const s={file_url:e,analysis_type:"ats_score",include_recommendations:!0};t&&(s.user_id=t,console.log("Including user_id for database saving:",t)),console.log("🚀 Making request to:",p),console.log("📤 Request body:",s);let o;const n=[{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({...s,analysis_type:"fast_ats_score"})},{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}];let d;for(let i=0;i<n.length;i++)try{console.log(`🔄 Attempt ${i+1}/2 with configuration:`,n[i]),console.log(i===0?"⚡ Trying fast analysis first...":"🔍 Trying comprehensive analysis...");const a=new AbortController,c=setTimeout(()=>{console.log(`⏰ Request ${i+1} timed out after 60 seconds`),a.abort()},6e4),m={...n[i],signal:a.signal};o=await fetch(p,m),clearTimeout(c),console.log(`✅ Attempt ${i+1} succeeded:`,o.status);break}catch(a){if(console.log(`❌ Attempt ${i+1} failed:`,a.message),d=a,i===n.length-1)throw d;await new Promise(c=>setTimeout(c,1e3))}if(console.log("📨 Response received:",o.status,o.statusText),!o.ok){let i=`API request failed: ${o.status}`;try{i=`API request failed: ${(await o.json()).error||o.statusText}`}catch{console.warn("Could not parse error response as JSON")}throw new Error(i)}const u=await o.json();return console.log("ATS analysis completed:",u),_(u,e)}catch(s){if(console.error("ATS analysis failed:",s),s.name==="TypeError"&&s.message.includes("Failed to fetch")){console.log("🔄 Primary API failed, attempting diagnostics...");try{const n=await fetch("https://httpbin.org/ip");console.log("✅ Internet connectivity confirmed, issue is with API endpoint")}catch{console.log("❌ No internet connectivity detected")}const o=new Error(`❌ Cannot connect to the resume analysis service.

🔍 Technical Details:
• Endpoint: ${p}
• Error: ${s.message}

🛠️ Possible Solutions:
• Check your internet connection
• Try refreshing the page
• Disable VPN or proxy if using one
• Try using a different browser
• Contact support if the issue persists

🌐 If you're on a corporate network, this service may be blocked by your firewall.`);throw o.name="NetworkError",o}throw s}}function _(e,t){return console.log("🔍 PROCESSING: rawResult.detailedAnalysis keys:",e.detailedAnalysis?Object.keys(e.detailedAnalysis).length:"NONE"),console.log("🔍 PROCESSING: rawResult.detailed_analysis keys:",e.detailed_analysis?Object.keys(e.detailed_analysis).length:"NONE"),{score:e.score||e.ats_score||0,scoreCategory:D(e.score||e.ats_score),strengths:e.strengths||[],improvements:e.improvements||[],detailedAnalysis:e.detailedAnalysis||e.detailed_analysis||{},keywords:e.keywords||[],missingKeywords:e.missing_keywords||[],formattingIssues:e.formatting_issues||[],suggestions:e.suggestions||[],originalFileUrl:t,file_url:e.file_url||t,content:e.content||"",timestamp:new Date().toISOString()}}function D(e){return e>=90?"excellent":e>=80?"good":e>=70?"fair":e>=60?"poor":"very_poor"}const F=async(e,t=null)=>C(e,t),I=document.getElementById("uploadForm"),g=document.getElementById("fileInput"),r=document.getElementById("analyzeBtn");document.getElementById("loadingState");const l=document.getElementById("uploadArea");function k(){console.log("BestCVBuilder initialized"),z(),W(),N(),X()}function N(){console.log("🏗️ BUILD INFO:",{BUILD_ID:v,API_BASE_URL:f,CV_PARSER_ENDPOINT:p});const e=document.createElement("div");e.id="build-info",e.style.cssText=`
        position: fixed; 
        bottom: 10px; 
        right: 10px; 
        background: #1f2937; 
        color: #10b981; 
        padding: 8px 12px; 
        border-radius: 6px; 
        font-family: monospace; 
        font-size: 11px; 
        z-index: 9999;
        border: 1px solid #10b981;
    `,e.textContent=`${v} | API: ${f}`,document.body.appendChild(e);const t=document.querySelector("h1");t&&(t.textContent=`BestCVBuilder [${v.slice(-10)}]`)}function z(){g&&g.addEventListener("change",O),I&&I.addEventListener("submit",$),document.addEventListener("resumeUpload",U),l&&(l.addEventListener("dragover",R),l.addEventListener("drop",V),l.addEventListener("dragenter",j),l.addEventListener("dragleave",Y))}function O(e){const t=e.target.files[0];if(t&&E(t)){const s=document.getElementById("fileName"),o=document.getElementById("fileInfo");s&&(s.textContent=t.name),o&&o.classList.remove("hidden"),r&&(r.disabled=!1)}}async function $(e){e.preventDefault();const t=g?g.files[0]:null;if(!t){y("Please select a resume file");return}await T(t)}async function U(e){const{file:t}=e.detail;t&&E(t)&&await T(t)}function E(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return y("Please upload a PDF, DOCX, or DOC file"),!1;const s=10*1024*1024;return e.size>s?(y("File size must be less than 10MB"),!1):(M(e),!0)}function M(e){const t=`${e.name} (${q(e.size)})`;console.log("File selected:",t)}function q(e){if(e===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+s[o]}async function T(e){try{console.log("🚀 Starting resume processing for:",e.name),await h.logActivity(null,"file_upload_started",{filename:e.name,filesize:e.size,filetype:e.type}),b(!0),console.log("📤 Step 1: Uploading file to storage..."),G();const t=await B(e);console.log("✅ File uploaded successfully:",t),await h.logActivity(null,"file_upload_completed",{filename:e.name,file_url:t}),console.log("🔍 Step 2: Starting ATS analysis..."),K();let s=null;try{const{data:{user:n}}=await A.auth.getUser();n?(s=n.id,console.log("User ID found for database saving:",s)):console.log("No user logged in - proceeding without database save")}catch(n){console.log("Error getting user:",n)}const o=await F(t,s);if(console.log("✅ Analysis completed:",o),!o||!o.score)throw new Error("Invalid analysis result received");await h.logActivity(s,"ats_analysis_completed",{score:o.score,scoreCategory:o.scoreCategory,filename:e.name,analysis_id:o.id||`analysis_${Date.now()}`}),console.log("💾 Step 3: Storing results..."),sessionStorage.setItem("atsAnalysis",JSON.stringify(o)),console.log("🔀 Step 4: Redirecting to results..."),window.location.href="./result.html"}catch(t){console.error("Error processing resume:",t);let s="Failed to analyze resume. Please try again.";t.message.includes("upload")?s="File upload failed. Please check your connection and try again.":(t.message.includes("analysis")||t.message.includes("analyze"))&&(s="Resume analysis failed. Please try again in a moment."),y(s)}finally{b(!1)}}function R(e){e.preventDefault(),l.classList.add("dragover")}function j(e){e.preventDefault(),l.classList.add("dragover")}function Y(e){e.preventDefault(),l.classList.remove("dragover")}function V(e){e.preventDefault(),l.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const s=t[0];if(g){const o=new DataTransfer;o.items.add(s),g.files=o.files}if(E(s)){const o=document.getElementById("fileName"),n=document.getElementById("fileInfo");o&&(o.textContent=s.name),n&&n.classList.remove("hidden"),r&&(r.disabled=!1)}}}class J{constructor(){this.currentStep=0,this.steps=["step-1","step-2","step-3"],this.isActive=!1}show(){const t=document.getElementById("atsLoadingScreen");t?(t.classList.remove("hidden"),this.isActive=!0,this.resetProgress()):console.warn("ATS Loading Screen element not found - falling back to basic loading")}hide(){const t=document.getElementById("atsLoadingScreen");t&&(t.classList.add("hidden"),this.isActive=!1)}resetProgress(){this.currentStep=0,this.updateProgress(0),this.updateTimeRemaining("few seconds"),this.steps.forEach((t,s)=>{const o=document.getElementById(t);if(o){const n=o.querySelector(".loading-dot");s===0?(o.style.opacity="1",n&&(n.classList.add("bg-blue-500"),n.classList.remove("bg-gray-500"),n.classList.add("animate-pulse"))):(o.style.opacity="0.4",n&&(n.classList.add("bg-gray-500"),n.classList.remove("bg-blue-500"),n.classList.remove("animate-pulse"))),o.classList.remove("step-complete")}})}completeStep(t){const s=this.steps.indexOf(t);if(s===-1)return;const o=document.getElementById(t);if(o){const u=o.querySelector(".loading-dot");o.classList.add("step-complete"),o.style.opacity="1",u&&(u.classList.remove("animate-pulse","bg-blue-500","bg-gray-500"),u.classList.add("bg-green-500"));const i=s+1;if(i<this.steps.length){const a=this.steps[i],c=document.getElementById(a);if(c){const m=c.querySelector(".loading-dot");c.style.opacity="1",m&&(m.classList.add("bg-blue-500","animate-pulse"),m.classList.remove("bg-gray-500"))}}}const n=Math.round((s+1)/this.steps.length*100);this.updateProgress(n);const d=s===this.steps.length-1?"ready!":"few seconds";this.updateTimeRemaining(d)}updateProgress(t){const s=document.getElementById("progressBar"),o=document.getElementById("progressText");s&&(s.style.width=`${t}%`),o&&(o.textContent=`${t}%`)}updateTimeRemaining(t){const s=document.getElementById("timeRemaining");s&&(s.textContent=t)}async startAnalysisSequence(){this.isActive&&(await this.delay(1500),this.completeStep("step-1"),this.isActive&&(await this.delay(2e3),this.completeStep("step-2"),this.isActive&&(await this.delay(1e3),this.completeStep("step-3"),this.isActive&&(this.updateProgress(100),this.updateTimeRemaining("ready!")))))}delay(t){return new Promise(s=>setTimeout(s,t))}}const S=new J;function b(e){const t=document.getElementById("buttonText"),s=document.getElementById("loadingText");if(e){try{S.show(),S.startAnalysisSequence()}catch(o){console.warn("ATS loading screen error, falling back to simple loading:",o)}t&&(t.style.display="none"),s&&(s.style.display="flex"),r&&(r.disabled=!0)}else{try{S.hide()}catch(o){console.warn("Error hiding ATS loading screen:",o)}t&&(t.style.display="inline"),s&&(s.style.display="none"),r&&(r.disabled=!1)}}function G(){console.log("📤 Upload progress started")}function K(){console.log("🔍 Analysis in progress")}function y(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}async function W(){try{const{data:{session:e}}=await A.auth.getSession();e&&console.log("User session found:",e.user.email)}catch(e){console.error("Error checking session:",e)}}function X(){const e=document.getElementById("testingControls"),t=document.getElementById("enableBypassBtn"),s=document.getElementById("disableBypassBtn"),o=window.location.hostname,n=o==="localhost"||o==="127.0.0.1"||o.includes("localhost")||o.includes("preview")||o.includes("render.com")||o.includes("onrender.com")||o.includes("vercel.app");if(console.log("🔍 Testing controls check:"),console.log("  - Current hostname:",o),console.log("  - Show testing controls:",n),n){e&&e.classList.remove("hidden");const d=sessionStorage.getItem("BYPASS_PAYMENT")==="true";w(d),t&&t.addEventListener("click",()=>{sessionStorage.setItem("BYPASS_PAYMENT","true"),w(!0),showSuccess("Payment bypass enabled for testing!")}),s&&s.addEventListener("click",()=>{sessionStorage.removeItem("BYPASS_PAYMENT"),w(!1),showSuccess("Payment bypass disabled")})}}function w(e){const t=document.getElementById("enableBypassBtn"),s=document.getElementById("disableBypassBtn");e?(t==null||t.classList.add("hidden"),s==null||s.classList.remove("hidden")):(t==null||t.classList.remove("hidden"),s==null||s.classList.add("hidden"))}document.addEventListener("DOMContentLoaded",k);
