import"./index-ARlhr7Pl-v2.js";import{D as c,s as b}from"./supabase-BQO_eFXx-v2.js";const d=document.getElementById("originalScore"),l=document.getElementById("newScore"),a=document.getElementById("improvement"),m=document.getElementById("downloadBtn"),i=document.getElementById("submitFeedbackBtn"),u=document.getElementById("newAnalysisBtn"),g=document.getElementById("homeBtn"),f=document.getElementById("optimizeForJobBtn"),h=document.getElementById("feedbackComment"),w=document.querySelectorAll(".rating-btn");let t=null,s=null;function v(){console.log("Success page initialized"),c.logActivity(null,"success_page_visited",{source:"upgrade_flow",timestamp:new Date().toISOString()}),k(),S()}function k(){try{const e=sessionStorage.getItem("cvRewriteResult");if(!e){console.warn("No CV rewrite data found"),r("No CV rewrite data available.");return}t=JSON.parse(e),console.log("Loaded CV rewrite data:",t),E()}catch(e){console.error("Error loading CV rewrite data:",e),r("Failed to load CV rewrite results.")}}function E(){if(!t)return;const e=t.original_score||0,n=t.new_score||0,o=t.score_improvement||0;d&&(d.textContent=e),l&&(l.textContent=n),a&&(a.textContent=`+${o}`,a.className=o>0?"text-lg font-semibold text-success-600":"text-lg font-semibold text-gray-600")}function S(){m&&m.addEventListener("click",_),i&&i.addEventListener("click",C),u&&u.addEventListener("click",I),g&&g.addEventListener("click",x),f&&f.addEventListener("click",D),w.forEach(e=>{e.addEventListener("click",B)})}async function _(){try{if(console.log("Initiating resume download..."),!t||!t.improved_resume_url){r("Download link not available. Please check your email.");return}const e=document.createElement("a");e.href=t.improved_resume_url,e.download=`improved_resume_${Date.now()}.pdf`,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),p("Download started! Check your downloads folder.")}catch(e){console.error("Download failed:",e),r("Download failed. Please try again or check your email.")}}function B(e){s=parseInt(e.currentTarget.dataset.rating),w.forEach(o=>{o.classList.remove("bg-primary-100","border-primary-500")}),e.currentTarget.classList.add("bg-primary-100","border-primary-500")}async function C(){var e;try{if(!s){r("Please select a rating");return}console.log("Submitting feedback...");const o=((e=(await b.auth.getUser()).data.user)==null?void 0:e.id)||"anonymous",y={rating:s.toString(),comment:h.value.trim(),category:"rewrite"};await c.saveFeedback(o,y),p("Thank you for your feedback!"),i.disabled=!0,i.textContent="Feedback Submitted"}catch(n){console.error("Feedback submission failed:",n),r("Failed to submit feedback. Please try again.")}}function I(){console.log("User wants new analysis"),sessionStorage.removeItem("atsAnalysis"),sessionStorage.removeItem("currentAnalysis"),sessionStorage.removeItem("upgradeAnalysis"),sessionStorage.removeItem("cvRewriteResult"),window.location.href="./index.html"}function x(){console.log("User going to home page"),window.location.href="./index.html"}function D(){console.log("User wants to optimize for specific job"),c.logActivity(null,"job_optimization_started",{original_score:(t==null?void 0:t.original_score)||"unknown",new_score:(t==null?void 0:t.new_score)||"unknown"}),t&&sessionStorage.setItem("currentRewriteData",JSON.stringify(t)),window.location.href="./job-input.html"}function p(e){const n=document.createElement("div");n.className="fixed top-4 right-4 bg-success-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.remove()},5e3)}function r(e){const n=document.createElement("div");n.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.remove()},5e3)}function L(){try{typeof gtag<"u"&&gtag("event","page_view",{page_title:"Success Page",page_location:window.location.href}),t&&typeof gtag<"u"&&gtag("event","purchase",{transaction_id:t.payment_id||"unknown",value:29,currency:"USD"})}catch(e){console.error("Error tracking engagement:",e)}}document.addEventListener("DOMContentLoaded",()=>{v(),L()});
