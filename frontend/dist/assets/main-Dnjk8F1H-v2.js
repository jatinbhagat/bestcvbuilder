import"./index-ARlhr7Pl-v2.js";import{S as I,s as h,D as d}from"./supabase-BQO_eFXx-v2.js";async function S(e,t=null){try{if(console.log("Starting file upload:",e.name),!E(e))throw new Error("Invalid file type or size");const o=await I.uploadFile(e,t);return console.log("File uploaded successfully:",o),o}catch(o){throw console.error("File upload failed:",o),o.message&&o.message.includes("violates row-level security")?new Error("Storage access denied. Please contact support."):o}}function E(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return console.error("Invalid file type:",e.type),!1;const o=10*1024*1024;return e.size>o?(console.error("File too large:",e.size),!1):!0}const B=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1",r=B?"https://bestcvbuilder-api.onrender.com/api":"/api",m=`${r}/cv-parser`,u="BUILD-2025-08-05-08:30:00-UI-FIXED";console.log("ðŸ”— API Configuration v1.1.0:",{API_BASE_URL:r,CV_PARSER_ENDPOINT:m});console.log("ðŸš¨ CRITICAL: Verify this shows correct URL - should NOT be bestcvbuilder-gamma!");async function b(e,t=null){try{console.log("Starting ATS analysis for file:",e);const o={file_url:e,analysis_type:"ats_score",include_recommendations:!0};t&&(o.user_id=t,console.log("Including user_id for database saving:",t));const n=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!n.ok)throw new Error(`API request failed: ${n.status}`);const s=await n.json();return console.log("ATS analysis completed:",s),L(s)}catch(o){throw console.error("ATS analysis failed:",o),o}}function L(e){return{score:e.ats_score||0,scoreCategory:x(e.ats_score),strengths:e.strengths||[],improvements:e.improvements||[],detailedAnalysis:e.detailed_analysis||"",keywords:e.keywords||[],missingKeywords:e.missing_keywords||[],formattingIssues:e.formatting_issues||[],suggestions:e.suggestions||[],timestamp:new Date().toISOString()}}function x(e){return e>=90?"excellent":e>=80?"good":e>=70?"fair":e>=60?"poor":"very_poor"}const _=async(e,t=null)=>b(e,t),p=document.getElementById("uploadForm"),l=document.getElementById("fileInput"),a=document.getElementById("analyzeBtn");document.getElementById("loadingState");const i=document.getElementById("uploadArea");function A(){console.log("BestCVBuilder initialized"),D(),R(),C(),V()}function C(){console.log("ðŸ—ï¸ BUILD INFO:",{BUILD_ID:u,API_BASE_URL:r,CV_PARSER_ENDPOINT:m});const e=document.createElement("div");e.id="build-info",e.style.cssText=`
        position: fixed; 
        bottom: 10px; 
        right: 10px; 
        background: #1f2937; 
        color: #10b981; 
        padding: 8px 12px; 
        border-radius: 6px; 
        font-family: monospace; 
        font-size: 11px; 
        z-index: 9999;
        border: 1px solid #10b981;
    `,e.textContent=`${u} | API: ${r}`,document.body.appendChild(e);const t=document.querySelector("h1");t&&(t.textContent=`BestCVBuilder [${u.slice(-10)}]`)}function D(){l&&l.addEventListener("change",T),p&&p.addEventListener("submit",P),document.addEventListener("resumeUpload",F),i&&(i.addEventListener("dragover",N),i.addEventListener("drop",O),i.addEventListener("dragenter",k),i.addEventListener("dragleave",M))}function T(e){const t=e.target.files[0];if(t&&g(t)){const o=document.getElementById("fileName"),n=document.getElementById("fileInfo");o&&(o.textContent=t.name),n&&n.classList.remove("hidden"),a&&(a.disabled=!1)}}async function P(e){e.preventDefault();const t=l?l.files[0]:null;if(!t){c("Please select a resume file");return}await v(t)}async function F(e){const{file:t}=e.detail;t&&g(t)&&await v(t)}function g(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return c("Please upload a PDF, DOCX, or DOC file"),!1;const o=10*1024*1024;return e.size>o?(c("File size must be less than 10MB"),!1):(z(e),!0)}function z(e){const t=`${e.name} (${U(e.size)})`;console.log("File selected:",t)}function U(e){if(e===0)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+o[n]}async function v(e){try{console.log("ðŸš€ Starting resume processing for:",e.name),await d.logActivity(null,"file_upload_started",{filename:e.name,filesize:e.size,filetype:e.type}),y(!0),console.log("ðŸ“¤ Step 1: Uploading file to storage..."),$();const t=await S(e);console.log("âœ… File uploaded successfully:",t),await d.logActivity(null,"file_upload_completed",{filename:e.name,file_url:t}),console.log("ðŸ” Step 2: Starting ATS analysis..."),Y();let o=null;try{const{data:{user:s}}=await h.auth.getUser();s?(o=s.id,console.log("User ID found for database saving:",o)):console.log("No user logged in - proceeding without database save")}catch(s){console.log("Error getting user:",s)}const n=await _(t,o);if(console.log("âœ… Analysis completed:",n),!n||!n.score)throw new Error("Invalid analysis result received");await d.logActivity(o,"ats_analysis_completed",{score:n.score,scoreCategory:n.scoreCategory,filename:e.name,analysis_id:n.id||`analysis_${Date.now()}`}),console.log("ðŸ’¾ Step 3: Storing results..."),sessionStorage.setItem("atsAnalysis",JSON.stringify(n)),console.log("ðŸ”€ Step 4: Redirecting to results..."),window.location.href="./result.html"}catch(t){console.error("Error processing resume:",t);let o="Failed to analyze resume. Please try again.";t.message.includes("upload")?o="File upload failed. Please check your connection and try again.":(t.message.includes("analysis")||t.message.includes("analyze"))&&(o="Resume analysis failed. Please try again in a moment."),c(o)}finally{y(!1)}}function N(e){e.preventDefault(),i.classList.add("dragover")}function k(e){e.preventDefault(),i.classList.add("dragover")}function M(e){e.preventDefault(),i.classList.remove("dragover")}function O(e){e.preventDefault(),i.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const o=t[0];if(l){const n=new DataTransfer;n.items.add(o),l.files=n.files}if(g(o)){const n=document.getElementById("fileName"),s=document.getElementById("fileInfo");n&&(n.textContent=o.name),s&&s.classList.remove("hidden"),a&&(a.disabled=!1)}}}function y(e){const t=document.getElementById("buttonText"),o=document.getElementById("loadingText");e?(t&&(t.style.display="none"),o&&(o.style.display="flex"),a&&(a.disabled=!0)):(t&&(t.style.display="inline"),o&&(o.style.display="none"),a&&(a.disabled=!1))}function $(){console.log("ðŸ“¤ Upload progress started")}function Y(){console.log("ðŸ” Analysis in progress")}function c(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}async function R(){try{const{data:{session:e}}=await h.auth.getSession();e&&console.log("User session found:",e.user.email)}catch(e){console.error("Error checking session:",e)}}function V(){const e=document.getElementById("testingControls"),t=document.getElementById("enableBypassBtn"),o=document.getElementById("disableBypassBtn"),n=window.location.hostname,s=n==="localhost"||n==="127.0.0.1"||n.includes("localhost")||n.includes("preview")||n.includes("render.com")||n.includes("onrender.com")||n.includes("vercel.app");if(console.log("ðŸ” Testing controls check:"),console.log("  - Current hostname:",n),console.log("  - Show testing controls:",s),s){e&&e.classList.remove("hidden");const w=sessionStorage.getItem("BYPASS_PAYMENT")==="true";f(w),t&&t.addEventListener("click",()=>{sessionStorage.setItem("BYPASS_PAYMENT","true"),f(!0),showSuccess("Payment bypass enabled for testing!")}),o&&o.addEventListener("click",()=>{sessionStorage.removeItem("BYPASS_PAYMENT"),f(!1),showSuccess("Payment bypass disabled")})}}function f(e){const t=document.getElementById("enableBypassBtn"),o=document.getElementById("disableBypassBtn");e?(t==null||t.classList.add("hidden"),o==null||o.classList.remove("hidden")):(t==null||t.classList.remove("hidden"),o==null||o.classList.add("hidden"))}document.addEventListener("DOMContentLoaded",A);
