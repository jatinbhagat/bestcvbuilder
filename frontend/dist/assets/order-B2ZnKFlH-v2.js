import"./modulepreload-polyfill-B5Qt9EMX-v2.js";/* empty css                  */let d=null,a=null,u=null;document.addEventListener("DOMContentLoaded",function(){console.log("üõí Initializing order creation page..."),P(),w()});function P(){try{let e=sessionStorage.getItem("pendingAnalysis")||sessionStorage.getItem("atsAnalysis");e?(d=JSON.parse(e),console.log("üìä Analysis data loaded:",d),h()):(console.error("‚ùå No analysis data found"),l("No resume analysis data found. Please go back and analyze your resume first."))}catch(e){console.error("‚ùå Error loading analysis data:",e),l("Failed to load resume data. Please try again.")}}async function h(){try{console.log("üîç Creating order with contact extraction...");const t=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?"https://bestcvbuilder-api.onrender.com/api":"/api",n=await fetch(`${t}/orders/create-order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({analysis_data:d})});if(!n.ok)throw new Error(`Order creation failed: ${n.status}`);const o=await n.json();console.log("‚úÖ Order created:",o),u=o.order,a=o.contact_info,v()}catch(e){console.error("‚ùå Order creation error:",e),l("Failed to create order. Please try again.")}}function v(){try{const e=document.getElementById("email"),t=document.getElementById("phone"),n=document.getElementById("phoneSelect"),o=document.getElementById("contactInfoAlert"),r=document.getElementById("extractedInfoText");let i="";a.emails&&a.emails.length>0&&(e.value=a.primary_email||a.emails[0],i+=`üìß ${a.emails.length} email${a.emails.length>1?"s":""} found. `,a.emails.length>1&&(i+=`(Options: ${a.emails.join(", ")}) `)),a.phone_numbers&&a.phone_numbers.length>0&&(a.phone_numbers.length===1?(t.value=a.primary_phone||a.phone_numbers[0],i+="üì± Phone number found."):(n.style.display="block",t.style.display="none",n.innerHTML='<option value="">Select a phone number</option>',a.phone_numbers.forEach(s=>{const c=document.createElement("option");c.value=s,c.textContent=s,n.appendChild(c)}),a.primary_phone&&(n.value=a.primary_phone),i+=`üì± ${a.phone_numbers.length} phone numbers found. Please select one.`)),i&&(r.textContent=i,o.style.display="block"),console.log("üìù Contact information populated")}catch(e){console.error("‚ùå Error populating contact info:",e)}}function w(){const e=document.getElementById("orderForm"),t=document.getElementById("phoneSelect");e.addEventListener("submit",S),t.addEventListener("change",function(){const r=document.getElementById("phone");r.value=this.value});const n=document.getElementById("email"),o=document.getElementById("phone");n.addEventListener("blur",g),o.addEventListener("blur",f)}function g(){const e=document.getElementById("email"),t=document.getElementById("emailError"),n=e.value.trim();return n?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?(E(e,t),!0):(m(e,t,"Please enter a valid email address"),!1):(m(e,t,"Email address is required"),!1)}function f(){const e=document.getElementById("phone"),t=document.getElementById("phoneSelect"),n=document.getElementById("phoneError"),o=t.style.display==="block"?t.value:e.value.trim();if(!o){const s=t.style.display==="block"?t:e;return m(s,n,"Mobile number is required"),!1}if(o.replace(/\D/g,"").length<10){const s=t.style.display==="block"?t:e;return m(s,n,"Please enter a valid mobile number"),!1}const i=t.style.display==="block"?t:e;return E(i,n),!0}function m(e,t,n){e.classList.add("error"),t.textContent=n}function E(e,t){e.classList.remove("error"),t.textContent=""}async function S(e){e.preventDefault();try{console.log("üöÄ Processing order submission...");const t=g(),n=f(),o=document.getElementById("termsCheck"),r=document.getElementById("termsError");let i=!0;if(o.checked?r.textContent="":(r.textContent="Please accept the terms and conditions",i=!1),!t||!n||!i){console.log("‚ùå Form validation failed");return}_();const s=document.getElementById("email"),c=document.getElementById("phone"),y=document.getElementById("phoneSelect"),B=s.value.trim(),b=y.style.display==="block"?y.value:c.value.trim();await I({order_id:u.order_id,email:B,phone:b})}catch(t){console.error("‚ùå Order submission error:",t),p(),l("Failed to process order. Please try again.")}}async function I(e){try{console.log("üí≥ Initiating PayU payment...");const n=window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?"https://bestcvbuilder-api.onrender.com/api":"/api",o=await fetch(`${n}/orders/initiate-payment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok)throw new Error(`Payment initiation failed: ${o.status}`);const r=await o.json();console.log("‚úÖ Payment data received:",r),L(r.payment_data,r.payu_url)}catch(t){console.error("‚ùå Payment initiation error:",t),p(),l("Failed to initiate payment. Please try again.")}}function L(e,t){try{console.log("üîÑ Redirecting to PayU...");const n=document.getElementById("payuForm");n.action=t,n.innerHTML="",Object.keys(e).forEach(o=>{const r=document.createElement("input");r.type="hidden",r.name=o,r.value=e[o],n.appendChild(r)}),sessionStorage.setItem("currentOrderId",u.order_id),sessionStorage.setItem("paymentInitiated","true"),n.submit(),console.log("‚úÖ Redirected to PayU payment gateway")}catch(n){console.error("‚ùå PayU redirection error:",n),p(),l("Failed to redirect to payment gateway. Please try again.")}}function _(){const e=document.getElementById("payButton"),t=document.getElementById("payButtonText"),n=document.getElementById("payButtonLoader");e.disabled=!0,t.style.display="none",n.style.display="inline-block",e.classList.add("loading")}function p(){const e=document.getElementById("payButton"),t=document.getElementById("payButtonText"),n=document.getElementById("payButtonLoader");e.disabled=!1,t.style.display="inline",n.style.display="none",e.classList.remove("loading")}function l(e){alert(e),console.error("‚ùå Error:",e)}window.debugOrderPage={analysisData:d,contactInfo:a,currentOrder:u,createOrderWithContactExtraction:h,initiatePayment:I};
