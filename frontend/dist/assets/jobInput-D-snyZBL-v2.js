import{s as b,D as f}from"./supabase-BWdB_AVO-v2.js";const d=document.getElementById("jobInputForm"),u=document.getElementById("analyzeJobBtn"),m=document.getElementById("buttonText"),l=document.getElementById("loadingText"),c=document.getElementById("formErrors"),v=document.getElementById("errorMessages"),i=document.getElementById("roleTitle"),h=document.getElementById("companyName"),n=document.getElementById("jobDescription"),E=document.getElementById("salaryMin"),_=document.getElementById("salaryMax"),x=document.getElementById("additionalNotes"),w=(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1","/api");let r=null;document.addEventListener("DOMContentLoaded",function(){console.log("Job input page initialized"),I(),j(),L()});async function I(){try{const{data:{user:e},error:t}=await b.auth.getUser();if(t){console.error("Error getting user:",t),r="anonymous_"+Date.now();return}e?(r=e.id,console.log("User authenticated:",e.email)):(r="anonymous_"+Date.now(),console.log("Anonymous user session"))}catch(e){console.error("Error initializing user:",e),r="anonymous_"+Date.now()}}function j(){d&&d.addEventListener("submit",J),[i,n].forEach(t=>{t&&(t.addEventListener("blur",T),t.addEventListener("input",g))}),n&&n.addEventListener("input",B)}function L(){if(n){const e=n.parentElement,t=document.createElement("div");t.id="charCounter",t.className="text-xs text-gray-500 mt-1 text-right",t.textContent="0 characters",e.appendChild(t)}}async function J(e){if(e.preventDefault(),console.log("Job input form submitted"),!!A()){y(!0),z();try{const t=S();sessionStorage.setItem("jobInputData",JSON.stringify(t));const o=await N(t);await C(t,o),sessionStorage.setItem("jobAnalysisResult",JSON.stringify(o)),D(),setTimeout(()=>{window.location.href="./optimization-results.html"},2e3)}catch(t){console.error("Error processing job input:",t),p([t.message||"Failed to analyze job requirements. Please try again."])}finally{y(!1)}}}function S(){const e=Array.from(document.querySelectorAll('input[name="focusAreas"]:checked')).map(t=>t.value);return{roleTitle:i.value.trim(),companyName:h.value.trim(),jobDescription:n.value.trim(),salaryRange:{min:E.value.trim(),max:_.value.trim()},focusAreas:e,additionalNotes:x.value.trim(),timestamp:new Date().toISOString(),userId:r}}function A(){const e=[];return i.value.trim()||(e.push("Job title is required"),s(i)),n.value.trim()?n.value.trim().length<50&&(e.push("Job description should be at least 50 characters long"),s(n)):(e.push("Job description is required"),s(n)),e.length>0?(p(e),!1):!0}function T(e){const t=e.target;g(t),t===i&&!t.value.trim()&&s(t,"Job title is required"),t===n&&(t.value.trim()?t.value.trim().length<50&&s(t,"Job description should be at least 50 characters"):s(t,"Job description is required"))}function s(e,t=null){if(e.classList.add("border-red-500"),e.classList.remove("border-gray-200","border-blue-500"),t){const o=e.parentElement.querySelector(".field-error");o&&o.remove();const a=document.createElement("div");a.className="field-error text-red-500 text-xs mt-1",a.textContent=t,e.parentElement.appendChild(a)}}function g(e){typeof e=="object"&&e.target&&(e=e.target),e.classList.remove("border-red-500"),e.classList.add("border-gray-200");const t=e.parentElement.querySelector(".field-error");t&&t.remove()}function B(){const e=document.getElementById("charCounter");if(e){const t=n.value.length;e.textContent=`${t} characters`,t<50?(e.classList.add("text-red-500"),e.classList.remove("text-gray-500")):(e.classList.add("text-gray-500"),e.classList.remove("text-red-500"))}}async function N(e){console.log("Calling job analyzer API...");const t=await fetch(`${w}/job-analyzer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_description:e.jobDescription,role_title:e.roleTitle,company_name:e.companyName,user_expectations:{salary_range:e.salaryRange,focus_areas:e.focusAreas,additional_notes:e.additionalNotes}})});if(!t.ok){const a=await t.json().catch(()=>({}));throw new Error(a.error||`HTTP ${t.status}: Failed to analyze job requirements`)}const o=await t.json();return console.log("Job analysis completed:",o),o}async function C(e,t){try{console.log("Saving job analysis to database...");const o={user_id:r,role_title:e.roleTitle,company_name:e.companyName,job_description:e.jobDescription,extracted_requirements:t.extracted_requirements||{},user_expectations:{salary_range:e.salaryRange,focus_areas:e.focusAreas,additional_notes:e.additionalNotes},analysis_score:t.analysis_score||0,matching_keywords:t.matching_keywords||[],created_at:new Date().toISOString()};r.startsWith("anonymous_")?(sessionStorage.setItem("jobAnalysisData",JSON.stringify(o)),console.log("Job analysis stored in session for anonymous user")):(await f.saveJobAnalysis(r,o),console.log("Job analysis saved to database"))}catch(o){console.error("Error saving job analysis:",o)}}function y(e){e?(u.disabled=!0,m.style.display="none",l.style.display="flex",l.classList.remove("hidden")):(u.disabled=!1,m.style.display="inline",l.style.display="none",l.classList.add("hidden"))}function p(e){v.innerHTML=e.map(t=>`<div>• ${t}</div>`).join(""),c.classList.remove("hidden"),c.scrollIntoView({behavior:"smooth",block:"center"})}function z(){c.classList.add("hidden")}function D(){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 flex items-center",e.innerHTML=`
        <span class="mr-2">✅</span>
        <div>
            <div class="font-bold">Job Analysis Complete!</div>
            <div class="text-sm opacity-90">Preparing your optimized resume...</div>
        </div>
    `,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}function F(e,t={}){try{typeof gtag<"u"&&gtag("event",e,t),console.log("Event tracked:",e,t)}catch(o){console.error("Error tracking event:",o)}}F("job_input_page_view",{page_title:"Job Input",page_location:window.location.href});
