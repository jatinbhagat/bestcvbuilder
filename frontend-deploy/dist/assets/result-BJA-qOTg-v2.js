import{s as V,D as K}from"./supabase-BMp_lEby-v2.js";import{c as X,g as Z,b as ee}from"./atsAnalysis-_Bdq-Cn9-v2.js";const d=document.getElementById("atsScore"),A=document.getElementById("scoreTitle"),B=document.getElementById("scoreDescription"),m=document.getElementById("scoreLetter"),f=document.getElementById("scoreCircle"),b=document.getElementById("strengthsList");document.getElementById("improvementsList");document.getElementById("detailedAnalysis");const M=document.getElementById("upgradeBtn"),R=document.getElementById("newAnalysisBtn"),j=document.getElementById("downloadReportBtn"),N=document.getElementById("criticalAlert"),P=document.getElementById("criticalAlertText");document.getElementById("mainDescription");const H=document.getElementById("currentRate"),q=document.getElementById("potentialRate"),v=document.getElementById("impactText"),y=document.getElementById("quickWinsList"),D=document.getElementById("quickWinsCount"),x=document.getElementById("criticalIssuesList"),F=document.getElementById("criticalIssuesCount"),w=document.getElementById("componentScores"),I=document.getElementById("beforeList"),E=document.getElementById("afterList"),O=document.getElementById("totalIssuesCount"),U=document.getElementById("targetScore"),W=document.getElementById("scoreImprovement"),z=document.getElementById("estimatedTime");let o=null;function te(){console.log("Results page initialized"),se(),de()}async function se(){try{const e=sessionStorage.getItem("atsAnalysis");if(!e){console.error("No analysis data found"),h("No analysis data available. Please upload a resume first.");return}o=JSON.parse(e),console.log("Loaded analysis data:",o);const s=!!(o.critical_issues&&o.quick_wins);console.log("Enhanced algorithm detected:",s),s?(console.log("Critical issues:",o.critical_issues.length),console.log("Quick wins:",o.quick_wins.length),console.log("Interview metrics:",!!o.interview_metrics)):console.log("Using legacy format - please upload a new resume to see enhanced features"),ne(),await xe()}catch(e){console.error("Error loading analysis data:",e),h("Failed to load analysis results.")}}function ne(){if(!o)return;const e=he(o);Ee(e),oe(o.score,o.scoreCategory,e),_e(e.quickWins),ke(e.criticalIssues),Se(o.detailedAnalysis),ce(o.strengths),$e(e),Ae(e),sessionStorage.setItem("currentAnalysis",JSON.stringify(o))}function oe(e,s,t){d&&(d.textContent=e),m&&(m.textContent=we(e)),A&&(A.textContent=`Your ATS Score: ${ie(s)}`),B&&(B.textContent=Ie(s,t));const n=t.interviewMetrics;if(H){const i=(n==null?void 0:n.current_rate)||u(e);H.textContent=i+"%"}if(q){const i=(n==null?void 0:n.potential_rate)||u(Math.min(e+40,95));q.textContent=i+"%"}if(v)if(n&&n.improvement_factor)v.textContent=`That's ${n.improvement_factor}x more interviews with the right improvements`;else{const i=Math.floor(u(Math.min(e+40,95))/u(e));v.textContent=`That's ${i}x more interviews with the right improvements`}re(s)}function ie(e){return{excellent:"Excellent",good:"Good",fair:"Fair",poor:"Poor",very_poor:"Very Poor"}[e]||"Unknown"}function re(e){if(!(!f||!d||!m))switch(f.classList.remove("bg-green-100","bg-blue-100","bg-yellow-100","bg-red-100","bg-red-200"),d.classList.remove("text-green-600","text-blue-600","text-yellow-600","text-red-600","text-red-700"),m.classList.remove("text-green-600","text-blue-600","text-yellow-600","text-red-600","text-red-700"),e){case"excellent":f.classList.add("bg-green-100","border-4","border-green-300"),d.classList.add("text-green-600"),m.classList.add("text-green-600");break;case"good":f.classList.add("bg-blue-100","border-4","border-blue-300"),d.classList.add("text-blue-600"),m.classList.add("text-blue-600");break;case"fair":f.classList.add("bg-yellow-100","border-4","border-yellow-300"),d.classList.add("text-yellow-600"),m.classList.add("text-yellow-600");break;case"poor":f.classList.add("bg-red-100","border-4","border-red-300"),d.classList.add("text-red-600"),m.classList.add("text-red-600");break;case"very_poor":f.classList.add("bg-red-200","border-4","border-red-400"),d.classList.add("text-red-700"),m.classList.add("text-red-700");break}}function ce(e){if(!b||!e)return;if(b.innerHTML="",e.slice(0,4).forEach(t=>{const n=document.createElement("div");n.className="bg-green-50 rounded-lg p-2 border-l-4 border-green-400",n.innerHTML=`
            <span class="text-sm text-gray-800 font-medium">${t}</span>
        `,b.appendChild(n)}),e.length>4){const t=document.createElement("div");t.className="text-xs text-green-600 font-medium text-center pt-2",t.textContent=`+${e.length-4} more strengths`,b.appendChild(t)}}function le(e){return{structure:25,keywords:20,contact:15,formatting:20,achievements:10,readability:10}[e]||20}function _(e){return{structure:"Resume Structure",keywords:"Keywords & Skills",contact:"Contact Information",formatting:"Formatting & Layout",achievements:"Achievements & Impact",readability:"Readability & Clarity"}[e]||e.charAt(0).toUpperCase()+e.slice(1)}function G(e){return e>=80?"text-green-600":e>=60?"text-blue-600":e>=40?"text-yellow-600":"text-red-600"}function ae(e){let s="";return e.missing_sections&&e.missing_sections.length>0&&(s+=`<p class="text-sm text-red-600 mb-1"><strong>Missing:</strong> ${e.missing_sections.join(", ")}</p>`),e.found_keywords&&e.found_keywords.length>0&&(s+=`<p class="text-sm text-green-600 mb-1"><strong>Found Keywords:</strong> ${e.found_keywords.slice(0,5).join(", ")}${e.found_keywords.length>5?"...":""}</p>`),e.missing_keywords&&e.missing_keywords.length>0&&(s+=`<p class="text-sm text-yellow-600 mb-1"><strong>Consider Adding:</strong> ${e.missing_keywords.slice(0,3).join(", ")}${e.missing_keywords.length>3?"...":""}</p>`),e.achievements_count!==void 0&&(s+=`<p class="text-sm text-gray-600"><strong>Quantified Achievements:</strong> ${e.achievements_count}</p>`),s||'<p class="text-sm text-gray-600">Component analyzed successfully</p>'}function de(){M&&M.addEventListener("click",Q);const e=document.getElementById("stickyUpgradeBtn");e&&e.addEventListener("click",Q);const s=document.getElementById("testImprovementBtn");s&&s.addEventListener("click",ue),R&&R.addEventListener("click",ge),j&&j.addEventListener("click",pe);const t=document.getElementById("toggleDetailedAnalysis"),n=document.getElementById("detailedAnalysisSection"),i=document.getElementById("detailsChevron");t&&n&&i&&t.addEventListener("click",()=>{n.classList.contains("hidden")?(n.classList.remove("hidden"),i.style.transform="rotate(180deg)"):(n.classList.add("hidden"),i.style.transform="rotate(0deg)")}),me()}function me(){const e=document.getElementById("upgradeBtn"),s=document.getElementById("stickyMobileCTA");if(!e||!s)return;new IntersectionObserver(n=>{n.forEach(i=>{i.isIntersecting?s.style.transform="translateY(100%)":s.style.transform="translateY(0)"})},{threshold:.1}).observe(e)}function Q(){console.log("User clicked upgrade"),o&&sessionStorage.setItem("upgradeAnalysis",JSON.stringify(o)),window.location.href="./payment.html"}async function ue(){if(console.log("🧪 TEST: Starting resume improvement test"),!o){h("No analysis data available for testing");return}try{const e=document.getElementById("testImprovementBtn");e&&(e.disabled=!0,e.textContent="Processing with AI...");const s="https://bestcvbuilder-api.onrender.com";console.log(`🚀 TEST: Calling resume-fix API at ${s}/api/resume-fix`),console.log(`📋 TEST: Analysis data keys: ${Object.keys(o)}`);const t=await fetch(`${s}/api/resume-fix`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({original_analysis:o,user_email:"test@bestcvbuilder.com",payment_id:`test_${Date.now()}`})});if(console.log(`📈 TEST: API Response status: ${t.status}`),!t.ok){const r=await t.text();throw console.error(`❌ TEST: API Error (${t.status}):`,r),new Error(`Resume improvement failed: ${t.status} - ${r}`)}const n=await t.json();console.log("✅ TEST: Resume improvement completed successfully"),console.log(`📊 TEST: Result keys: ${Object.keys(n)}`),console.log(`📄 TEST: Has PDF URL: ${"improved_resume_url"in n}`),sessionStorage.setItem("cvRewriteResult",JSON.stringify(n)),console.log("💾 TEST: Stored result in sessionStorage");const i=document.createElement("div");i.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",i.textContent="AI Improvement Complete! Redirecting...",document.body.appendChild(i),setTimeout(()=>{window.location.href="./success.html"},2e3)}catch(e){console.error("❌ TEST: Resume improvement failed:",e),h(`Test failed: ${e.message}`);const s=document.getElementById("testImprovementBtn");s&&(s.disabled=!1,s.textContent="🧪 Test AI Improvement")}}function ge(){console.log("User wants new analysis"),sessionStorage.removeItem("atsAnalysis"),sessionStorage.removeItem("currentAnalysis"),window.location.href="./index.html"}async function pe(){try{console.log("Generating downloadable report");const e=fe();ye(e)}catch(e){console.error("Error generating report:",e),h("Failed to generate report.")}}function fe(){if(!o)return null;const e=X(o),s=Z(o);return{title:"ATS Analysis Report",score:o.score,category:o.scoreCategory,description:ee(o.scoreCategory),strengths:o.strengths,improvements:o.improvements,suggestions:s,potentialImprovement:e,detailedAnalysis:o.detailedAnalysis,timestamp:o.timestamp}}function ye(e){const s=JSON.stringify(e,null,2),t=new Blob([s],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=`ats-analysis-report-${Date.now()}.json`,n.click()}function h(e){const s=document.createElement("div");s.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",s.textContent=e,document.body.appendChild(s),setTimeout(()=>{s.remove()},5e3)}async function xe(){try{const e=await V.auth.getUser();e.data.user&&o&&(await K.saveAnalysisResult(e.data.user.id,o),console.log("Analysis saved to database"))}catch(e){console.error("Failed to save analysis to database:",e)}}function he(e){var r,l,a,c,k,S,T,C,L;if(e.critical_issues&&e.quick_wins&&e.content_improvements)return{quickWins:e.quick_wins||[],criticalIssues:e.critical_issues||[],contentImprovements:e.content_improvements||[],beforeItems:((r=e.transformation_preview)==null?void 0:r.before)||J(e),afterItems:((l=e.transformation_preview)==null?void 0:l.after)||Y(e),totalIssues:e.total_issues||(((a=e.critical_issues)==null?void 0:a.length)||0)+(((c=e.quick_wins)==null?void 0:c.length)||0)+(((k=e.content_improvements)==null?void 0:k.length)||0),potentialImprovement:e.potential_improvement||10,realisticTargetScore:e.realistic_target_score||Math.min(e.score+10,95),estimatedTime:e.estimated_time||"30 minutes",interviewMetrics:e.interview_metrics||null,transformationPreview:e.transformation_preview||null};if(e.critical_issues&&e.quick_wins)return{quickWins:e.quick_wins||[],criticalIssues:e.critical_issues||[],contentImprovements:[],beforeItems:((S=e.transformation_preview)==null?void 0:S.before)||J(e),afterItems:((T=e.transformation_preview)==null?void 0:T.after)||Y(e),totalIssues:(((C=e.critical_issues)==null?void 0:C.length)||0)+(((L=e.quick_wins)==null?void 0:L.length)||0),potentialImprovement:Math.min(e.score*.3,25),realisticTargetScore:Math.min(e.score+25,95),estimatedTime:"45 minutes",interviewMetrics:e.interview_metrics||null,transformationPreview:e.transformation_preview||null};const s=[],t=[],n=[],i=[];return e.improvements&&e.improvements.length>0&&e.improvements.forEach(g=>{be(g)?s.push({title:g,time_to_fix:"2 minutes",impact:"High",points_gain:5,icon:"lightning"}):t.push({title:g,time_to_fix:"10-15 minutes",impact:"High",points_gain:10,solution:ve(g)})}),e.detailedAnalysis&&typeof e.detailedAnalysis=="object"&&Object.entries(e.detailedAnalysis).forEach(([g,p])=>{p&&p.missing_sections&&p.missing_sections.forEach($=>{t.push({title:`Missing ${$} section`,component:_(g),solution:`Add a dedicated ${$} section to your resume`,time_to_fix:"5-10 minutes",impact:"High",points_gain:8})}),p&&p.missing_keywords&&p.missing_keywords.length>0&&s.push({title:`Add ${p.missing_keywords.slice(0,3).join(", ")} keywords`,component:_(g),time_to_fix:"1-2 minutes",impact:"Medium",points_gain:3,icon:"keyword"})}),n.push(`ATS Score: ${e.score}/100`),i.push(`ATS Score: ${Math.min(e.score+40,95)}/100`),s.length>0&&(n.push("Missing key optimizations"),i.push("Fully optimized with industry keywords")),t.length>0&&(n.push(`${t.length} critical formatting issues`),i.push("Professional ATS-friendly formatting")),n.push(`${u(e.score)}% interview rate`),i.push(`${u(Math.min(e.score+40,95))}% interview rate`),{quickWins:s.slice(0,3),criticalIssues:t.slice(0,5),beforeItems:n,afterItems:i,totalIssues:s.length+t.length}}function J(e){const s=[`ATS Score: ${e.score}/100`];return(e.scoreCategory==="poor"||e.scoreCategory==="very_poor")&&(s.push("Poor ATS compatibility"),s.push("Missing critical sections")),s.push(`${u(e.score)}% interview rate`),s}function Y(e){const s=Math.min(e.score+40,95),t=[`ATS Score: ${s}/100`];return t.push("Fully ATS-optimized"),t.push("Professional structure"),t.push(`${u(s)}% interview rate`),t}function be(e){return[/phone/i,/email/i,/contact/i,/linkedin/i,/keyword/i,/skill/i,/bullet/i,/spacing/i,/margin/i,/font/i,/bold/i,/italic/i].some(t=>t.test(e))}function ve(e){const s={"missing contact information":"Add your phone number, email, and LinkedIn profile URL at the top","no professional summary":"Write a 2-3 sentence summary highlighting your key qualifications","weak achievement descriptions":"Rewrite accomplishments using numbers and action verbs","poor keyword optimization":"Research job descriptions and add relevant industry keywords","formatting inconsistencies":"Use consistent fonts, spacing, and bullet point styles","missing skills section":"Create a dedicated skills section with 8-12 relevant technical skills"},t=e.toLowerCase();for(const[n,i]of Object.entries(s))if(t.includes(n))return i;return"Review and optimize this section for better ATS compatibility"}function we(e){return e>=90?"A":e>=80?"B":e>=70?"C":e>=60?"D":"F"}function Ie(e,s){var n;return s.transformationPreview&&s.transformationPreview.summary?s.transformationPreview.summary:{excellent:"Outstanding! Your resume is highly optimized for ATS systems.",good:`Good performance, but ${s.totalIssues} improvements could boost your score significantly.`,fair:`Your resume needs attention. ${((n=s.criticalIssues)==null?void 0:n.length)||0} critical issues are blocking ATS systems.`,poor:`Major optimization needed. ${s.totalIssues} issues are preventing interviews.`,very_poor:"Critical problems detected. Your resume likely won't pass ATS screening."}[e]||"Analysis complete - see details below."}function u(e){return e>=85?15:e>=75?8:e>=65?5:e>=55?3:2}function Ee(e){!N||e.criticalIssues.length<3||(N.classList.remove("hidden"),P&&(P.textContent=`${e.criticalIssues.length} critical issues are preventing your resume from passing ATS systems.`))}function _e(e){if(!y||!D)return;if(D.textContent=e.length,y.innerHTML="",e.length===0){y.innerHTML='<p class="text-blue-700 text-sm">Great! No quick fixes needed.</p>';return}if(e.slice(0,2).forEach(t=>{const n=document.createElement("div");n.className="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-400 mb-3";const i=t.points_gain||t.pointsGain||3,r=t.time_to_fix||"2 minutes",l=t.category||"Quick Fix",a=t.description||"",c=t.solution||"";n.innerHTML=`
            <div class="flex items-start justify-between mb-2">
                <div class="flex-1">
                    <h4 class="text-sm font-semibold text-gray-900 mb-1">${t.title}</h4>
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">${l}</span>
                        <span class="text-xs text-gray-600">⚡ ${r}</span>
                    </div>
                    ${a?`<p class="text-xs text-gray-700 mb-2">${a}</p>`:""}
                    ${c?`<p class="text-xs text-green-800 bg-green-50 p-2 rounded border-l-2 border-green-200"><strong>Quick Fix:</strong> ${c}</p>`:""}
                </div>
                <span class="text-xs bg-blue-600 text-white px-2 py-1 rounded-full font-medium ml-3">+${i}pts</span>
            </div>
        `,y.appendChild(n)}),e.length>2){const t=document.createElement("div");t.className="text-center pt-2",t.innerHTML=`
            <button class="text-xs text-blue-600 hover:text-blue-800 font-medium bg-blue-50 hover:bg-blue-100 px-3 py-2 rounded-lg border border-blue-200 transition-colors">
                View ${e.length-2} More Quick Fixes →
            </button>
        `,y.appendChild(t)}}function ke(e){if(!x||!F)return;if(F.textContent=e.length,x.innerHTML="",e.length===0){x.innerHTML='<p class="text-green-700 text-sm">Excellent! No critical issues found.</p>';return}if(e.slice(0,3).forEach(t=>{const n=document.createElement("div");n.className="bg-red-50 rounded-lg p-4 border-l-4 border-red-400 mb-3";const i=t.points_gain||t.pointsGain||8,r=t.time_to_fix||"5 minutes",l=t.category||"General",a=t.description||"",c=t.solution||"";n.innerHTML=`
            <div class="flex items-start justify-between mb-2">
                <div class="flex-1">
                    <h4 class="text-sm font-semibold text-gray-900 mb-1">${t.title}</h4>
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full">${l}</span>
                        <span class="text-xs text-gray-600">⏱ ${r}</span>
                    </div>
                    ${a?`<p class="text-xs text-gray-700 mb-2">${a}</p>`:""}
                    ${c?`<p class="text-xs text-blue-800 bg-blue-50 p-2 rounded border-l-2 border-blue-200"><strong>Solution:</strong> ${c}</p>`:""}
                </div>
                <span class="text-xs bg-red-600 text-white px-2 py-1 rounded-full font-medium ml-3">+${i}pts</span>
            </div>
        `,x.appendChild(n)}),e.length>3){const t=document.createElement("div");t.className="text-center pt-2",t.innerHTML=`
            <button class="text-xs text-red-600 hover:text-red-800 font-medium bg-red-50 hover:bg-red-100 px-3 py-2 rounded-lg border border-red-200 transition-colors">
                View ${e.length-3} More Critical Issues →
            </button>
        `,x.appendChild(t)}}function Se(e){!w||!e||typeof e!="object"||(w.innerHTML="",Object.entries(e).forEach(([s,t])=>{if(t&&typeof t=="object"&&t.score!==void 0){const n=le(s),i=Math.round(t.score/n*100),r=_(s),l=document.createElement("div");l.className="bg-gray-50 border border-gray-200 rounded-xl p-4";const a=t.letter_grade||Te(i),c=t.recommendations||[];l.innerHTML=`
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-bold text-gray-900">${r}</h4>
                    <div class="text-right">
                        <div class="flex items-center space-x-2">
                            <span class="text-xl font-bold ${G(i)}">${t.score}</span>
                            <span class="text-sm text-gray-500">/${n}</span>
                            <span class="text-sm font-bold ${G(i)} bg-white px-2 py-1 rounded-lg">${a}</span>
                        </div>
                        <div class="text-xs text-gray-500">${i}%</div>
                    </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 mb-3">
                    <div class="${Le(i)} h-3 rounded-full transition-all duration-700" style="width: ${i}%"></div>
                </div>
                ${ae(t)}
                ${c.length>0?Ce(c):""}
            `,w.appendChild(l)}}))}function Te(e){return e>=90?"A+":e>=80?"A":e>=70?"B":e>=60?"C":e>=50?"D":"F"}function Ce(e){return!e||e.length===0?"":`
        <div class="mt-3 bg-blue-50 rounded-lg p-3">
            <p class="text-xs font-bold text-blue-800 mb-2">💡 Quick improvements:</p>
            <ul class="space-y-1">${e.slice(0,2).map(t=>`<li class="text-xs text-blue-700">• ${t}</li>`).join("")}</ul>
        </div>
    `}function Le(e){return e>=80?"bg-green-500":e>=60?"bg-blue-500":e>=40?"bg-yellow-500":"bg-red-500"}function $e(e){!I||!E||(I.innerHTML="",E.innerHTML="",e.beforeItems.forEach(s=>{const t=document.createElement("li");t.className="flex items-center text-red-700",t.innerHTML=`
            <svg class="w-4 h-4 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            ${s}
        `,I.appendChild(t)}),e.afterItems.forEach(s=>{const t=document.createElement("li");t.className="flex items-center text-green-700",t.innerHTML=`
            <svg class="w-4 h-4 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            ${s}
        `,E.appendChild(t)}))}function Ae(e){var s,t;if(O&&(O.textContent=e.totalIssues),U&&o){const n=((s=e.interviewMetrics)==null?void 0:s.target_score)||Math.min(o.score+40,95);U.textContent=n}if(W&&o){const n=((t=e.interviewMetrics)==null?void 0:t.score_improvement)||Math.min(40,95-o.score);W.textContent=`+${n}`}if(z){let n;e.transformationPreview&&e.transformationPreview.estimated_time?n=e.transformationPreview.estimated_time:n=e.totalIssues<=3?"3 minutes":e.totalIssues<=6?"5 minutes":"7 minutes",z.textContent=n}}document.addEventListener("DOMContentLoaded",te);
