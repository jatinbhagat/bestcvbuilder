import{s as y,D as w}from"./supabase-BMp_lEby-v2.js";const c=document.getElementById("originalScore"),l=document.getElementById("newScore"),s=document.getElementById("improvement"),d=document.getElementById("downloadBtn"),a=document.getElementById("submitFeedbackBtn"),m=document.getElementById("newAnalysisBtn"),u=document.getElementById("homeBtn"),p=document.getElementById("feedbackComment"),g=document.querySelectorAll(".rating-btn");let t=null,i=null;function E(){console.log("Success page initialized"),C(),h()}function C(){try{console.log("ðŸ” SUCCESS-PAGE: Looking for CV rewrite data in sessionStorage...");const e=sessionStorage.getItem("cvRewriteResult");if(!e){console.warn("âŒ SUCCESS-PAGE: No CV rewrite data found in sessionStorage"),console.log("ðŸ” SUCCESS-PAGE: Available sessionStorage keys:",Object.keys(sessionStorage)),r("No CV rewrite data available. Please try the process again.");return}console.log("âœ… SUCCESS-PAGE: Found CV rewrite data in sessionStorage"),console.log("ðŸ“Š SUCCESS-PAGE: Raw data length:",e.length),t=JSON.parse(e),console.log("ðŸ“„ SUCCESS-PAGE: Parsed CV rewrite data:",t),console.log("ðŸ”‘ SUCCESS-PAGE: Data keys:",Object.keys(t)),t.improved_resume_url?(console.log("ðŸ“„ SUCCESS-PAGE: PDF URL found:",t.improved_resume_url),console.log("ðŸ“„ SUCCESS-PAGE: PDF URL type:",typeof t.improved_resume_url),console.log("ðŸ“„ SUCCESS-PAGE: PDF URL starts with:",t.improved_resume_url.substring(0,50))):console.warn("âš ï¸ SUCCESS-PAGE: No improved_resume_url found in data!"),b()}catch(e){console.error("Error loading CV rewrite data:",e),r("Failed to load CV rewrite results.")}}function b(){if(!t)return;const e=t.original_score||0,o=t.new_score||0,n=t.score_improvement||0;c&&(c.textContent=e),l&&(l.textContent=o),s&&(s.textContent=`+${n}`,s.className=n>0?"text-lg font-semibold text-success-600":"text-lg font-semibold text-gray-600")}function h(){d&&d.addEventListener("click",v),a&&a.addEventListener("click",_),m&&m.addEventListener("click",P),u&&u.addEventListener("click",D),g.forEach(e=>{e.addEventListener("click",k)})}async function v(){try{if(console.log("Initiating resume download..."),!t||!t.improved_resume_url){r("Download link not available. Please check your email.");return}const e=document.createElement("a");e.href=t.improved_resume_url,e.download=`improved_resume_${Date.now()}.pdf`,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),S("Download started! Check your downloads folder.")}catch(e){console.error("Download failed:",e),r("Download failed. Please try again or check your email.")}}function k(e){i=parseInt(e.currentTarget.dataset.rating),g.forEach(n=>{n.classList.remove("bg-primary-100","border-primary-500")}),e.currentTarget.classList.add("bg-primary-100","border-primary-500")}async function _(){var e;try{if(!i){r("Please select a rating");return}console.log("Submitting feedback...");const n=((e=(await y.auth.getUser()).data.user)==null?void 0:e.id)||"anonymous",f={rating:i.toString(),comment:p.value.trim(),category:"rewrite"};await w.saveFeedback(n,f),S("Thank you for your feedback!"),a.disabled=!0,a.textContent="Feedback Submitted"}catch(o){console.error("Feedback submission failed:",o),r("Failed to submit feedback. Please try again.")}}function P(){console.log("User wants new analysis"),sessionStorage.removeItem("atsAnalysis"),sessionStorage.removeItem("currentAnalysis"),sessionStorage.removeItem("upgradeAnalysis"),sessionStorage.removeItem("cvRewriteResult"),window.location.href="./index.html"}function D(){console.log("User going to home page"),window.location.href="./index.html"}function S(e){const o=document.createElement("div");o.className="fixed top-4 right-4 bg-success-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.remove()},5e3)}function r(e){const o=document.createElement("div");o.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.remove()},5e3)}function A(){try{typeof gtag<"u"&&gtag("event","page_view",{page_title:"Success Page",page_location:window.location.href}),t&&typeof gtag<"u"&&gtag("event","purchase",{transaction_id:t.payment_id||"unknown",value:29,currency:"USD"})}catch(e){console.error("Error tracking engagement:",e)}}document.addEventListener("DOMContentLoaded",()=>{E(),A()});
