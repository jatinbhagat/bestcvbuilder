import{S as y,s as g}from"./supabase-BMp_lEby-v2.js";import{C as h,A as c,B as r,a as v}from"./atsAnalysis-DtNXMMla-v2.js";async function B(e,t=null){try{if(console.log("Starting file upload:",e.name),!E(e))throw new Error("Invalid file type or size");const o=await y.uploadFile(e,t);return console.log("File uploaded successfully:",o),o}catch(o){throw console.error("File upload failed:",o),o.message&&o.message.includes("violates row-level security")?new Error("Storage access denied. Please contact support."):o}}function E(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return console.error("Invalid file type:",e.type),!1;const o=10*1024*1024;return e.size>o?(console.error("File too large:",e.size),!1):!0}const i=document.getElementById("uploadForm"),d=document.getElementById("resumeFile"),u=document.getElementById("uploadBtn"),m=document.getElementById("loadingState"),s=document.querySelector(".border-dashed");function w(){console.log("BestCVBuilder initialized"),L(),O(),I()}function I(){console.log("🏗️ BUILD INFO:",{BUILD_ID:r,API_BASE_URL:c,CV_PARSER_ENDPOINT:h});const e=document.createElement("div");e.id="build-info",e.style.cssText=`
        position: fixed; 
        bottom: 10px; 
        right: 10px; 
        background: #1f2937; 
        color: #10b981; 
        padding: 8px 12px; 
        border-radius: 6px; 
        font-family: monospace; 
        font-size: 11px; 
        z-index: 9999;
        border: 1px solid #10b981;
    `,e.textContent=`${r} | API: ${c}`,document.body.appendChild(e);const t=document.querySelector("h1");t&&(t.textContent=`BestCVBuilder [${r.slice(-10)}]`)}function L(){d.addEventListener("change",S),i.addEventListener("submit",b),s&&(s.addEventListener("dragover",D),s.addEventListener("drop",U),s.addEventListener("dragenter",z),s.addEventListener("dragleave",C))}function S(e){const t=e.target.files[0];t&&f(t)}async function b(e){e.preventDefault();const t=d.files[0];if(!t){l("Please select a resume file");return}await x(t)}function f(e){if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(e.type))return l("Please upload a PDF, DOCX, or DOC file"),!1;const o=10*1024*1024;return e.size>o?(l("File size must be less than 10MB"),!1):(F(e),!0)}function F(e){const t=`${e.name} (${P(e.size)})`;console.log("File selected:",t)}function P(e){if(e===0)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+o[n]}async function x(e){try{console.log("🚀 Starting resume processing for:",e.name),p(!0),console.log("📤 Step 1: Uploading file to storage..."),A();const t=await B(e);console.log("✅ File uploaded successfully:",t),M(),await new Promise(a=>setTimeout(a,800)),console.log("🔍 Step 2: Starting ATS analysis..."),R();let o=null;try{const{data:{user:a}}=await g.auth.getUser();a?(o=a.id,console.log("User ID found for database saving:",o)):console.log("No user logged in - proceeding without database save")}catch(a){console.log("Error getting user:",a)}const n=await v(t,o);if(console.log("✅ Analysis completed:",n),!n||!n.score)throw new Error("Invalid analysis result received");console.log("💾 Step 3: Storing results..."),sessionStorage.setItem("atsAnalysis",JSON.stringify(n)),console.log("🔀 Step 4: Redirecting to results..."),window.location.href="./result.html"}catch(t){console.error("Error processing resume:",t);let o="Failed to analyze resume. Please try again.";t.message.includes("upload")?o="File upload failed. Please check your connection and try again.":(t.message.includes("analysis")||t.message.includes("analyze"))&&(o="Resume analysis failed. Please try again in a moment."),l(o)}finally{p(!1)}}function D(e){e.preventDefault(),s.classList.add("border-primary-500","bg-primary-50")}function z(e){e.preventDefault(),s.classList.add("border-primary-500","bg-primary-50")}function C(e){e.preventDefault(),s.classList.remove("border-primary-500","bg-primary-50")}function U(e){e.preventDefault(),s.classList.remove("border-primary-500","bg-primary-50");const t=e.dataTransfer.files;if(t.length>0){const o=t[0];d.files=t,f(o)}}function p(e){e?(i.classList.add("hidden"),m.classList.remove("hidden"),u.disabled=!0,T()):(i.classList.remove("hidden"),m.classList.add("hidden"),u.disabled=!1)}function T(){document.getElementById("uploadProgress").classList.remove("hidden"),document.getElementById("uploadComplete").classList.add("hidden"),document.getElementById("analysisProgress").classList.add("hidden"),document.getElementById("uploadBar").style.width="0%"}function A(){document.getElementById("uploadProgress").classList.remove("hidden"),document.getElementById("uploadComplete").classList.add("hidden"),document.getElementById("analysisProgress").classList.add("hidden");let e=0;const t=document.getElementById("uploadBar"),o=setInterval(()=>{e+=Math.random()*15,e>=95&&(e=95,clearInterval(o)),t.style.width=e+"%"},100)}function M(){document.getElementById("uploadBar").style.width="100%",setTimeout(()=>{document.getElementById("uploadProgress").classList.add("hidden"),document.getElementById("uploadComplete").classList.remove("hidden")},300)}function R(){document.getElementById("uploadComplete").classList.add("hidden"),document.getElementById("analysisProgress").classList.remove("hidden")}function l(e){const t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}async function O(){try{const{data:{session:e}}=await g.auth.getSession();e&&console.log("User session found:",e.user.email)}catch(e){console.error("Error checking session:",e)}}document.addEventListener("DOMContentLoaded",w);
